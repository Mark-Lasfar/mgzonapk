bc71ab240ccb53cde476cb0eaddd9ff0
'use server';
"use strict";

/* istanbul ignore next */
function cov_qiqd1fki6() {
  var path = "/home/hager/new/my-nextjs-project-master (3)/my-nextjs-project-master/lib/actions/review.actions.ts";
  var hash = "cebb0400226a1689164a7b9bc4f33f9a46d70a1d";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/home/hager/new/my-nextjs-project-master (3)/my-nextjs-project-master/lib/actions/review.actions.ts",
    statementMap: {
      "0": {
        start: {
          line: 3,
          column: 0
        },
        end: {
          line: 5,
          column: 3
        }
      },
      "1": {
        start: {
          line: 7,
          column: 4
        },
        end: {
          line: 10,
          column: 7
        }
      },
      "2": {
        start: {
          line: 7,
          column: 24
        },
        end: {
          line: 10,
          column: 7
        }
      },
      "3": {
        start: {
          line: 12,
          column: 0
        },
        end: {
          line: 22,
          column: 3
        }
      },
      "4": {
        start: {
          line: 14,
          column: 8
        },
        end: {
          line: 14,
          column: 34
        }
      },
      "5": {
        start: {
          line: 17,
          column: 8
        },
        end: {
          line: 17,
          column: 36
        }
      },
      "6": {
        start: {
          line: 20,
          column: 8
        },
        end: {
          line: 20,
          column: 26
        }
      },
      "7": {
        start: {
          line: 23,
          column: 32
        },
        end: {
          line: 23,
          column: 77
        }
      },
      "8": {
        start: {
          line: 24,
          column: 15
        },
        end: {
          line: 24,
          column: 36
        }
      },
      "9": {
        start: {
          line: 25,
          column: 14
        },
        end: {
          line: 25,
          column: 35
        }
      },
      "10": {
        start: {
          line: 26,
          column: 12
        },
        end: {
          line: 26,
          column: 28
        }
      },
      "11": {
        start: {
          line: 27,
          column: 36
        },
        end: {
          line: 27,
          column: 99
        }
      },
      "12": {
        start: {
          line: 28,
          column: 35
        },
        end: {
          line: 28,
          column: 97
        }
      },
      "13": {
        start: {
          line: 29,
          column: 15
        },
        end: {
          line: 29,
          column: 34
        }
      },
      "14": {
        start: {
          line: 30,
          column: 19
        },
        end: {
          line: 30,
          column: 42
        }
      },
      "15": {
        start: {
          line: 31,
          column: 24
        },
        end: {
          line: 31,
          column: 52
        }
      },
      "16": {
        start: {
          line: 33,
          column: 4
        },
        end: {
          line: 35,
          column: 6
        }
      },
      "17": {
        start: {
          line: 38,
          column: 4
        },
        end: {
          line: 77,
          column: 5
        }
      },
      "18": {
        start: {
          line: 39,
          column: 24
        },
        end: {
          line: 39,
          column: 47
        }
      },
      "19": {
        start: {
          line: 40,
          column: 8
        },
        end: {
          line: 42,
          column: 9
        }
      },
      "20": {
        start: {
          line: 41,
          column: 12
        },
        end: {
          line: 41,
          column: 57
        }
      },
      "21": {
        start: {
          line: 43,
          column: 23
        },
        end: {
          line: 46,
          column: 10
        }
      },
      "22": {
        start: {
          line: 47,
          column: 8
        },
        end: {
          line: 47,
          column: 43
        }
      },
      "23": {
        start: {
          line: 48,
          column: 28
        },
        end: {
          line: 51,
          column: 10
        }
      },
      "24": {
        start: {
          line: 52,
          column: 8
        },
        end: {
          line: 71,
          column: 9
        }
      },
      "25": {
        start: {
          line: 53,
          column: 12
        },
        end: {
          line: 53,
          column: 49
        }
      },
      "26": {
        start: {
          line: 54,
          column: 12
        },
        end: {
          line: 54,
          column: 47
        }
      },
      "27": {
        start: {
          line: 55,
          column: 12
        },
        end: {
          line: 55,
          column: 45
        }
      },
      "28": {
        start: {
          line: 56,
          column: 12
        },
        end: {
          line: 56,
          column: 37
        }
      },
      "29": {
        start: {
          line: 57,
          column: 12
        },
        end: {
          line: 57,
          column: 54
        }
      },
      "30": {
        start: {
          line: 58,
          column: 12
        },
        end: {
          line: 58,
          column: 45
        }
      },
      "31": {
        start: {
          line: 59,
          column: 12
        },
        end: {
          line: 62,
          column: 14
        }
      },
      "32": {
        start: {
          line: 64,
          column: 12
        },
        end: {
          line: 64,
          column: 54
        }
      },
      "33": {
        start: {
          line: 65,
          column: 12
        },
        end: {
          line: 65,
          column: 54
        }
      },
      "34": {
        start: {
          line: 66,
          column: 12
        },
        end: {
          line: 66,
          column: 45
        }
      },
      "35": {
        start: {
          line: 67,
          column: 12
        },
        end: {
          line: 70,
          column: 14
        }
      },
      "36": {
        start: {
          line: 73,
          column: 8
        },
        end: {
          line: 76,
          column: 10
        }
      },
      "37": {
        start: {
          line: 79,
          column: 28
        },
        end: {
          line: 118,
          column: 1
        }
      },
      "38": {
        start: {
          line: 81,
          column: 19
        },
        end: {
          line: 95,
          column: 6
        }
      },
      "39": {
        start: {
          line: 97,
          column: 25
        },
        end: {
          line: 97,
          column: 72
        }
      },
      "40": {
        start: {
          line: 97,
          column: 57
        },
        end: {
          line: 97,
          column: 68
        }
      },
      "41": {
        start: {
          line: 98,
          column: 22
        },
        end: {
          line: 98,
          column: 95
        }
      },
      "42": {
        start: {
          line: 98,
          column: 59
        },
        end: {
          line: 98,
          column: 76
        }
      },
      "43": {
        start: {
          line: 100,
          column: 22
        },
        end: {
          line: 103,
          column: 10
        }
      },
      "44": {
        start: {
          line: 101,
          column: 8
        },
        end: {
          line: 101,
          column: 25
        }
      },
      "45": {
        start: {
          line: 102,
          column: 8
        },
        end: {
          line: 102,
          column: 19
        }
      },
      "46": {
        start: {
          line: 105,
          column: 31
        },
        end: {
          line: 105,
          column: 33
        }
      },
      "47": {
        start: {
          line: 106,
          column: 4
        },
        end: {
          line: 111,
          column: 5
        }
      },
      "48": {
        start: {
          line: 106,
          column: 16
        },
        end: {
          line: 106,
          column: 17
        }
      },
      "49": {
        start: {
          line: 107,
          column: 8
        },
        end: {
          line: 110,
          column: 11
        }
      },
      "50": {
        start: {
          line: 113,
          column: 4
        },
        end: {
          line: 117,
          column: 7
        }
      },
      "51": {
        start: {
          line: 120,
          column: 37
        },
        end: {
          line: 120,
          column: 76
        }
      },
      "52": {
        start: {
          line: 121,
          column: 4
        },
        end: {
          line: 121,
          column: 30
        }
      },
      "53": {
        start: {
          line: 122,
          column: 4
        },
        end: {
          line: 122,
          column: 39
        }
      },
      "54": {
        start: {
          line: 123,
          column: 23
        },
        end: {
          line: 123,
          column: 41
        }
      },
      "55": {
        start: {
          line: 124,
          column: 20
        },
        end: {
          line: 128,
          column: 36
        }
      },
      "56": {
        start: {
          line: 129,
          column: 25
        },
        end: {
          line: 131,
          column: 6
        }
      },
      "57": {
        start: {
          line: 132,
          column: 4
        },
        end: {
          line: 135,
          column: 6
        }
      },
      "58": {
        start: {
          line: 137,
          column: 29
        },
        end: {
          line: 148,
          column: 1
        }
      },
      "59": {
        start: {
          line: 138,
          column: 4
        },
        end: {
          line: 138,
          column: 39
        }
      },
      "60": {
        start: {
          line: 139,
          column: 20
        },
        end: {
          line: 139,
          column: 43
        }
      },
      "61": {
        start: {
          line: 140,
          column: 4
        },
        end: {
          line: 142,
          column: 5
        }
      },
      "62": {
        start: {
          line: 141,
          column: 8
        },
        end: {
          line: 141,
          column: 53
        }
      },
      "63": {
        start: {
          line: 143,
          column: 19
        },
        end: {
          line: 146,
          column: 6
        }
      },
      "64": {
        start: {
          line: 147,
          column: 4
        },
        end: {
          line: 147,
          column: 62
        }
      }
    },
    fnMap: {
      "0": {
        name: "_export",
        decl: {
          start: {
            line: 6,
            column: 9
          },
          end: {
            line: 6,
            column: 16
          }
        },
        loc: {
          start: {
            line: 6,
            column: 30
          },
          end: {
            line: 11,
            column: 1
          }
        },
        line: 6
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 13,
            column: 24
          },
          end: {
            line: 13,
            column: 25
          }
        },
        loc: {
          start: {
            line: 13,
            column: 35
          },
          end: {
            line: 15,
            column: 5
          }
        },
        line: 13
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 16,
            column: 26
          },
          end: {
            line: 16,
            column: 27
          }
        },
        loc: {
          start: {
            line: 16,
            column: 37
          },
          end: {
            line: 18,
            column: 5
          }
        },
        line: 16
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 19,
            column: 16
          },
          end: {
            line: 19,
            column: 17
          }
        },
        loc: {
          start: {
            line: 19,
            column: 27
          },
          end: {
            line: 21,
            column: 5
          }
        },
        line: 19
      },
      "4": {
        name: "_interop_require_default",
        decl: {
          start: {
            line: 32,
            column: 9
          },
          end: {
            line: 32,
            column: 33
          }
        },
        loc: {
          start: {
            line: 32,
            column: 39
          },
          end: {
            line: 36,
            column: 1
          }
        },
        line: 32
      },
      "5": {
        name: "createUpdateReview",
        decl: {
          start: {
            line: 37,
            column: 15
          },
          end: {
            line: 37,
            column: 33
          }
        },
        loc: {
          start: {
            line: 37,
            column: 50
          },
          end: {
            line: 78,
            column: 1
          }
        },
        line: 37
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 79,
            column: 28
          },
          end: {
            line: 79,
            column: 29
          }
        },
        loc: {
          start: {
            line: 79,
            column: 47
          },
          end: {
            line: 118,
            column: 1
          }
        },
        line: 79
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 97,
            column: 39
          },
          end: {
            line: 97,
            column: 40
          }
        },
        loc: {
          start: {
            line: 97,
            column: 57
          },
          end: {
            line: 97,
            column: 68
          }
        },
        line: 97
      },
      "8": {
        name: "(anonymous_8)",
        decl: {
          start: {
            line: 98,
            column: 36
          },
          end: {
            line: 98,
            column: 37
          }
        },
        loc: {
          start: {
            line: 98,
            column: 59
          },
          end: {
            line: 98,
            column: 76
          }
        },
        line: 98
      },
      "9": {
        name: "(anonymous_9)",
        decl: {
          start: {
            line: 100,
            column: 36
          },
          end: {
            line: 100,
            column: 37
          }
        },
        loc: {
          start: {
            line: 100,
            column: 59
          },
          end: {
            line: 103,
            column: 5
          }
        },
        line: 100
      },
      "10": {
        name: "getReviews",
        decl: {
          start: {
            line: 119,
            column: 15
          },
          end: {
            line: 119,
            column: 25
          }
        },
        loc: {
          start: {
            line: 119,
            column: 54
          },
          end: {
            line: 136,
            column: 1
          }
        },
        line: 119
      },
      "11": {
        name: "(anonymous_11)",
        decl: {
          start: {
            line: 137,
            column: 29
          },
          end: {
            line: 137,
            column: 30
          }
        },
        loc: {
          start: {
            line: 137,
            column: 52
          },
          end: {
            line: 148,
            column: 1
          }
        },
        line: 137
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 33,
            column: 11
          },
          end: {
            line: 35,
            column: 5
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 33,
            column: 35
          },
          end: {
            line: 33,
            column: 38
          }
        }, {
          start: {
            line: 33,
            column: 41
          },
          end: {
            line: 35,
            column: 5
          }
        }],
        line: 33
      },
      "1": {
        loc: {
          start: {
            line: 33,
            column: 11
          },
          end: {
            line: 33,
            column: 32
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 33,
            column: 11
          },
          end: {
            line: 33,
            column: 14
          }
        }, {
          start: {
            line: 33,
            column: 18
          },
          end: {
            line: 33,
            column: 32
          }
        }],
        line: 33
      },
      "2": {
        loc: {
          start: {
            line: 40,
            column: 8
          },
          end: {
            line: 42,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 40,
            column: 8
          },
          end: {
            line: 42,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 40
      },
      "3": {
        loc: {
          start: {
            line: 52,
            column: 8
          },
          end: {
            line: 71,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 52,
            column: 8
          },
          end: {
            line: 71,
            column: 9
          }
        }, {
          start: {
            line: 63,
            column: 15
          },
          end: {
            line: 71,
            column: 9
          }
        }],
        line: 52
      },
      "4": {
        loc: {
          start: {
            line: 109,
            column: 19
          },
          end: {
            line: 109,
            column: 36
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 109,
            column: 19
          },
          end: {
            line: 109,
            column: 31
          }
        }, {
          start: {
            line: 109,
            column: 35
          },
          end: {
            line: 109,
            column: 36
          }
        }],
        line: 109
      },
      "5": {
        loc: {
          start: {
            line: 121,
            column: 12
          },
          end: {
            line: 121,
            column: 29
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 121,
            column: 12
          },
          end: {
            line: 121,
            column: 17
          }
        }, {
          start: {
            line: 121,
            column: 21
          },
          end: {
            line: 121,
            column: 29
          }
        }],
        line: 121
      },
      "6": {
        loc: {
          start: {
            line: 134,
            column: 20
          },
          end: {
            line: 134,
            column: 76
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 134,
            column: 41
          },
          end: {
            line: 134,
            column: 42
          }
        }, {
          start: {
            line: 134,
            column: 45
          },
          end: {
            line: 134,
            column: 76
          }
        }],
        line: 134
      },
      "7": {
        loc: {
          start: {
            line: 140,
            column: 4
          },
          end: {
            line: 142,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 140,
            column: 4
          },
          end: {
            line: 142,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 140
      },
      "8": {
        loc: {
          start: {
            line: 147,
            column: 11
          },
          end: {
            line: 147,
            column: 61
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 147,
            column: 20
          },
          end: {
            line: 147,
            column: 54
          }
        }, {
          start: {
            line: 147,
            column: 57
          },
          end: {
            line: 147,
            column: 61
          }
        }],
        line: 147
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0,
      "61": 0,
      "62": 0,
      "63": 0,
      "64": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["/home/hager/new/my-nextjs-project-master (3)/my-nextjs-project-master/lib/actions/review.actions.ts"],
      sourcesContent: ["'use server'\n\nimport mongoose from 'mongoose'\nimport { revalidatePath } from 'next/cache'\nimport { z } from 'zod'\n\nimport { auth } from '@/auth'\n\nimport { connectToDatabase } from '../db'\nimport Product from '../db/models/product.model'\nimport Review, { IReview } from '../db/models/review.model'\nimport { formatError } from '../utils'\nimport { ReviewInputSchema } from '../validator'\nimport { IReviewDetails } from '@/types'\nimport { getSetting } from './setting.actions'\n\nexport async function createUpdateReview({\n  data,\n  path,\n}: {\n  data: z.infer<typeof ReviewInputSchema>\n  path: string\n}) {\n  try {\n    const session = await auth()\n    if (!session) {\n      throw new Error('User is not authenticated')\n    }\n\n    const review = ReviewInputSchema.parse({\n      ...data,\n      user: session?.user?.id,\n    })\n\n    await connectToDatabase()\n    const existReview = await Review.findOne({\n      product: review.product,\n      user: review.user,\n    })\n\n    if (existReview) {\n      existReview.comment = review.comment\n      existReview.rating = review.rating\n      existReview.title = review.title\n      await existReview.save()\n      await updateProductReview(review.product)\n      revalidatePath(path)\n      return {\n        success: true,\n        message: 'Review updated successfully',\n        // data: JSON.parse(JSON.stringify(existReview)),\n      }\n    } else {\n      await Review.create(review)\n      await updateProductReview(review.product)\n      revalidatePath(path)\n      return {\n        success: true,\n        message: 'Review created successfully',\n        // data: JSON.parse(JSON.stringify(newReview)),\n      }\n    }\n  } catch (error) {\n    return {\n      success: false,\n      message: formatError(error),\n    }\n  }\n}\n\nconst updateProductReview = async (productId: string) => {\n  // Calculate the new average rating, number of reviews, and rating distribution\n  const result = await Review.aggregate([\n    { $match: { product: new mongoose.Types.ObjectId(productId) } },\n    {\n      $group: {\n        _id: '$rating',\n        count: { $sum: 1 },\n      },\n    },\n  ])\n  // Calculate the total number of reviews and average rating\n  const totalReviews = result.reduce((sum, { count }) => sum + count, 0)\n  const avgRating =\n    result.reduce((sum, { _id, count }) => sum + _id * count, 0) / totalReviews\n\n  // Convert aggregation result to a map for easier lookup\n  const ratingMap = result.reduce((map, { _id, count }) => {\n    map[_id] = count\n    return map\n  }, {})\n  // Ensure all ratings 1-5 are represented, with missing ones set to count: 0\n  const ratingDistribution = []\n  for (let i = 1; i <= 5; i++) {\n    ratingDistribution.push({ rating: i, count: ratingMap[i] || 0 })\n  }\n  // Update product fields with calculated values\n  await Product.findByIdAndUpdate(productId, {\n    avgRating: avgRating.toFixed(1),\n    numReviews: totalReviews,\n    ratingDistribution,\n  })\n}\n\nexport async function getReviews({\n  productId,\n  limit,\n  page,\n}: {\n  productId: string\n  limit?: number\n  page: number\n}) {\n  const {\n    common: { pageSize },\n  } = await getSetting()\n  limit = limit || pageSize\n  await connectToDatabase()\n  const skipAmount = (page - 1) * limit\n  const reviews = await Review.find({ product: productId })\n    .populate('user', 'name')\n    .sort({\n      createdAt: 'desc',\n    })\n    .skip(skipAmount)\n    .limit(limit)\n  const reviewsCount = await Review.countDocuments({ product: productId })\n  return {\n    data: JSON.parse(JSON.stringify(reviews)) as IReviewDetails[],\n    totalPages: reviewsCount === 0 ? 1 : Math.ceil(reviewsCount / limit),\n  }\n}\nexport const getReviewByProductId = async ({\n  productId,\n}: {\n  productId: string\n}) => {\n  await connectToDatabase()\n  const session = await auth()\n  if (!session) {\n    throw new Error('User is not authenticated')\n  }\n  const review = await Review.findOne({\n    product: productId,\n    user: session?.user?.id,\n  })\n  return review ? (JSON.parse(JSON.stringify(review)) as IReview) : null\n}\n"],
      names: ["createUpdateReview", "getReviewByProductId", "getReviews", "data", "path", "session", "auth", "Error", "review", "ReviewInputSchema", "parse", "user", "id", "connectToDatabase", "existReview", "Review", "findOne", "product", "comment", "rating", "title", "save", "updateProductReview", "revalidatePath", "success", "message", "create", "error", "formatError", "productId", "result", "aggregate", "$match", "mongoose", "Types", "ObjectId", "$group", "_id", "count", "$sum", "totalReviews", "reduce", "sum", "avgRating", "ratingMap", "map", "ratingDistribution", "i", "push", "Product", "findByIdAndUpdate", "toFixed", "numReviews", "limit", "page", "common", "pageSize", "getSetting", "skipAmount", "reviews", "find", "populate", "sort", "createdAt", "skip", "reviewsCount", "countDocuments", "JSON", "stringify", "totalPages", "Math", "ceil"],
      mappings: "AAAA;;;;;;;;;;;;IAgBsBA,kBAAkB;eAAlBA;;IAoHTC,oBAAoB;eAApBA;;IA5BSC,UAAU;eAAVA;;;iEAtGD;uBACU;sBAGV;oBAEa;qEACd;oEACY;uBACJ;2BACM;gCAEP;;;;;;AAEpB,eAAeF,mBAAmB,EACvCG,IAAI,EACJC,IAAI,EAIL;IACC,IAAI;QACF,MAAMC,UAAU,MAAMC,IAAAA,UAAI;QAC1B,IAAI,CAACD,SAAS;YACZ,MAAM,IAAIE,MAAM;QAClB;QAEA,MAAMC,SAASC,4BAAiB,CAACC,KAAK,CAAC;YACrC,GAAGP,IAAI;YACPQ,MAAMN,SAASM,MAAMC;QACvB;QAEA,MAAMC,IAAAA,qBAAiB;QACvB,MAAMC,cAAc,MAAMC,oBAAM,CAACC,OAAO,CAAC;YACvCC,SAAST,OAAOS,OAAO;YACvBN,MAAMH,OAAOG,IAAI;QACnB;QAEA,IAAIG,aAAa;YACfA,YAAYI,OAAO,GAAGV,OAAOU,OAAO;YACpCJ,YAAYK,MAAM,GAAGX,OAAOW,MAAM;YAClCL,YAAYM,KAAK,GAAGZ,OAAOY,KAAK;YAChC,MAAMN,YAAYO,IAAI;YACtB,MAAMC,oBAAoBd,OAAOS,OAAO;YACxCM,IAAAA,qBAAc,EAACnB;YACf,OAAO;gBACLoB,SAAS;gBACTC,SAAS;YAEX;QACF,OAAO;YACL,MAAMV,oBAAM,CAACW,MAAM,CAAClB;YACpB,MAAMc,oBAAoBd,OAAOS,OAAO;YACxCM,IAAAA,qBAAc,EAACnB;YACf,OAAO;gBACLoB,SAAS;gBACTC,SAAS;YAEX;QACF;IACF,EAAE,OAAOE,OAAO;QACd,OAAO;YACLH,SAAS;YACTC,SAASG,IAAAA,kBAAW,EAACD;QACvB;IACF;AACF;AAEA,MAAML,sBAAsB,OAAOO;IACjC,+EAA+E;IAC/E,MAAMC,SAAS,MAAMf,oBAAM,CAACgB,SAAS,CAAC;QACpC;YAAEC,QAAQ;gBAAEf,SAAS,IAAIgB,iBAAQ,CAACC,KAAK,CAACC,QAAQ,CAACN;YAAW;QAAE;QAC9D;YACEO,QAAQ;gBACNC,KAAK;gBACLC,OAAO;oBAAEC,MAAM;gBAAE;YACnB;QACF;KACD;IACD,2DAA2D;IAC3D,MAAMC,eAAeV,OAAOW,MAAM,CAAC,CAACC,KAAK,EAAEJ,KAAK,EAAE,GAAKI,MAAMJ,OAAO;IACpE,MAAMK,YACJb,OAAOW,MAAM,CAAC,CAACC,KAAK,EAAEL,GAAG,EAAEC,KAAK,EAAE,GAAKI,MAAML,MAAMC,OAAO,KAAKE;IAEjE,wDAAwD;IACxD,MAAMI,YAAYd,OAAOW,MAAM,CAAC,CAACI,KAAK,EAAER,GAAG,EAAEC,KAAK,EAAE;QAClDO,GAAG,CAACR,IAAI,GAAGC;QACX,OAAOO;IACT,GAAG,CAAC;IACJ,4EAA4E;IAC5E,MAAMC,qBAAqB,EAAE;IAC7B,IAAK,IAAIC,IAAI,GAAGA,KAAK,GAAGA,IAAK;QAC3BD,mBAAmBE,IAAI,CAAC;YAAE7B,QAAQ4B;YAAGT,OAAOM,SAAS,CAACG,EAAE,IAAI;QAAE;IAChE;IACA,+CAA+C;IAC/C,MAAME,qBAAO,CAACC,iBAAiB,CAACrB,WAAW;QACzCc,WAAWA,UAAUQ,OAAO,CAAC;QAC7BC,YAAYZ;QACZM;IACF;AACF;AAEO,eAAe5C,WAAW,EAC/B2B,SAAS,EACTwB,KAAK,EACLC,IAAI,EAKL;IACC,MAAM,EACJC,QAAQ,EAAEC,QAAQ,EAAE,EACrB,GAAG,MAAMC,IAAAA,0BAAU;IACpBJ,QAAQA,SAASG;IACjB,MAAM3C,IAAAA,qBAAiB;IACvB,MAAM6C,aAAa,AAACJ,CAAAA,OAAO,CAAA,IAAKD;IAChC,MAAMM,UAAU,MAAM5C,oBAAM,CAAC6C,IAAI,CAAC;QAAE3C,SAASY;IAAU,GACpDgC,QAAQ,CAAC,QAAQ,QACjBC,IAAI,CAAC;QACJC,WAAW;IACb,GACCC,IAAI,CAACN,YACLL,KAAK,CAACA;IACT,MAAMY,eAAe,MAAMlD,oBAAM,CAACmD,cAAc,CAAC;QAAEjD,SAASY;IAAU;IACtE,OAAO;QACL1B,MAAMgE,KAAKzD,KAAK,CAACyD,KAAKC,SAAS,CAACT;QAChCU,YAAYJ,iBAAiB,IAAI,IAAIK,KAAKC,IAAI,CAACN,eAAeZ;IAChE;AACF;AACO,MAAMpD,uBAAuB,OAAO,EACzC4B,SAAS,EAGV;IACC,MAAMhB,IAAAA,qBAAiB;IACvB,MAAMR,UAAU,MAAMC,IAAAA,UAAI;IAC1B,IAAI,CAACD,SAAS;QACZ,MAAM,IAAIE,MAAM;IAClB;IACA,MAAMC,SAAS,MAAMO,oBAAM,CAACC,OAAO,CAAC;QAClCC,SAASY;QACTlB,MAAMN,SAASM,MAAMC;IACvB;IACA,OAAOJ,SAAU2D,KAAKzD,KAAK,CAACyD,KAAKC,SAAS,CAAC5D,WAAuB;AACpE"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "cebb0400226a1689164a7b9bc4f33f9a46d70a1d"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_qiqd1fki6 = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_qiqd1fki6();
cov_qiqd1fki6().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
function _export(target, all) {
  /* istanbul ignore next */
  cov_qiqd1fki6().f[0]++;
  cov_qiqd1fki6().s[1]++;
  for (var name in all) {
    /* istanbul ignore next */
    cov_qiqd1fki6().s[2]++;
    Object.defineProperty(target, name, {
      enumerable: true,
      get: all[name]
    });
  }
}
/* istanbul ignore next */
cov_qiqd1fki6().s[3]++;
_export(exports, {
  createUpdateReview: function () {
    /* istanbul ignore next */
    cov_qiqd1fki6().f[1]++;
    cov_qiqd1fki6().s[4]++;
    return createUpdateReview;
  },
  getReviewByProductId: function () {
    /* istanbul ignore next */
    cov_qiqd1fki6().f[2]++;
    cov_qiqd1fki6().s[5]++;
    return getReviewByProductId;
  },
  getReviews: function () {
    /* istanbul ignore next */
    cov_qiqd1fki6().f[3]++;
    cov_qiqd1fki6().s[6]++;
    return getReviews;
  }
});
const _mongoose =
/* istanbul ignore next */
(/*#__PURE__*/cov_qiqd1fki6().s[7]++, _interop_require_default(require("mongoose")));
const _cache =
/* istanbul ignore next */
(cov_qiqd1fki6().s[8]++, require("next/cache"));
const _auth =
/* istanbul ignore next */
(cov_qiqd1fki6().s[9]++, require("../../auth"));
const _db =
/* istanbul ignore next */
(cov_qiqd1fki6().s[10]++, require("../db"));
const _productmodel =
/* istanbul ignore next */
(/*#__PURE__*/cov_qiqd1fki6().s[11]++, _interop_require_default(require("../db/models/product.model")));
const _reviewmodel =
/* istanbul ignore next */
(/*#__PURE__*/cov_qiqd1fki6().s[12]++, _interop_require_default(require("../db/models/review.model")));
const _utils =
/* istanbul ignore next */
(cov_qiqd1fki6().s[13]++, require("../utils"));
const _validator =
/* istanbul ignore next */
(cov_qiqd1fki6().s[14]++, require("../validator"));
const _settingactions =
/* istanbul ignore next */
(cov_qiqd1fki6().s[15]++, require("./setting.actions"));
function _interop_require_default(obj) {
  /* istanbul ignore next */
  cov_qiqd1fki6().f[4]++;
  cov_qiqd1fki6().s[16]++;
  return /* istanbul ignore next */(cov_qiqd1fki6().b[1][0]++, obj) &&
  /* istanbul ignore next */
  (cov_qiqd1fki6().b[1][1]++, obj.__esModule) ?
  /* istanbul ignore next */
  (cov_qiqd1fki6().b[0][0]++, obj) :
  /* istanbul ignore next */
  (cov_qiqd1fki6().b[0][1]++, {
    default: obj
  });
}
async function createUpdateReview({
  data,
  path
}) {
  /* istanbul ignore next */
  cov_qiqd1fki6().f[5]++;
  cov_qiqd1fki6().s[17]++;
  try {
    const session =
    /* istanbul ignore next */
    (cov_qiqd1fki6().s[18]++, await (0, _auth.auth)());
    /* istanbul ignore next */
    cov_qiqd1fki6().s[19]++;
    if (!session) {
      /* istanbul ignore next */
      cov_qiqd1fki6().b[2][0]++;
      cov_qiqd1fki6().s[20]++;
      throw new Error('User is not authenticated');
    } else
    /* istanbul ignore next */
    {
      cov_qiqd1fki6().b[2][1]++;
    }
    const review =
    /* istanbul ignore next */
    (cov_qiqd1fki6().s[21]++, _validator.ReviewInputSchema.parse({
      ...data,
      user: session?.user?.id
    }));
    /* istanbul ignore next */
    cov_qiqd1fki6().s[22]++;
    await (0, _db.connectToDatabase)();
    const existReview =
    /* istanbul ignore next */
    (cov_qiqd1fki6().s[23]++, await _reviewmodel.default.findOne({
      product: review.product,
      user: review.user
    }));
    /* istanbul ignore next */
    cov_qiqd1fki6().s[24]++;
    if (existReview) {
      /* istanbul ignore next */
      cov_qiqd1fki6().b[3][0]++;
      cov_qiqd1fki6().s[25]++;
      existReview.comment = review.comment;
      /* istanbul ignore next */
      cov_qiqd1fki6().s[26]++;
      existReview.rating = review.rating;
      /* istanbul ignore next */
      cov_qiqd1fki6().s[27]++;
      existReview.title = review.title;
      /* istanbul ignore next */
      cov_qiqd1fki6().s[28]++;
      await existReview.save();
      /* istanbul ignore next */
      cov_qiqd1fki6().s[29]++;
      await updateProductReview(review.product);
      /* istanbul ignore next */
      cov_qiqd1fki6().s[30]++;
      (0, _cache.revalidatePath)(path);
      /* istanbul ignore next */
      cov_qiqd1fki6().s[31]++;
      return {
        success: true,
        message: 'Review updated successfully'
      };
    } else {
      /* istanbul ignore next */
      cov_qiqd1fki6().b[3][1]++;
      cov_qiqd1fki6().s[32]++;
      await _reviewmodel.default.create(review);
      /* istanbul ignore next */
      cov_qiqd1fki6().s[33]++;
      await updateProductReview(review.product);
      /* istanbul ignore next */
      cov_qiqd1fki6().s[34]++;
      (0, _cache.revalidatePath)(path);
      /* istanbul ignore next */
      cov_qiqd1fki6().s[35]++;
      return {
        success: true,
        message: 'Review created successfully'
      };
    }
  } catch (error) {
    /* istanbul ignore next */
    cov_qiqd1fki6().s[36]++;
    return {
      success: false,
      message: (0, _utils.formatError)(error)
    };
  }
}
/* istanbul ignore next */
cov_qiqd1fki6().s[37]++;
const updateProductReview = async productId => {
  /* istanbul ignore next */
  cov_qiqd1fki6().f[6]++;
  // Calculate the new average rating, number of reviews, and rating distribution
  const result =
  /* istanbul ignore next */
  (cov_qiqd1fki6().s[38]++, await _reviewmodel.default.aggregate([{
    $match: {
      product: new _mongoose.default.Types.ObjectId(productId)
    }
  }, {
    $group: {
      _id: '$rating',
      count: {
        $sum: 1
      }
    }
  }]));
  // Calculate the total number of reviews and average rating
  const totalReviews =
  /* istanbul ignore next */
  (cov_qiqd1fki6().s[39]++, result.reduce((sum, {
    count
  }) => {
    /* istanbul ignore next */
    cov_qiqd1fki6().f[7]++;
    cov_qiqd1fki6().s[40]++;
    return sum + count;
  }, 0));
  const avgRating =
  /* istanbul ignore next */
  (cov_qiqd1fki6().s[41]++, result.reduce((sum, {
    _id,
    count
  }) => {
    /* istanbul ignore next */
    cov_qiqd1fki6().f[8]++;
    cov_qiqd1fki6().s[42]++;
    return sum + _id * count;
  }, 0) / totalReviews);
  // Convert aggregation result to a map for easier lookup
  const ratingMap =
  /* istanbul ignore next */
  (cov_qiqd1fki6().s[43]++, result.reduce((map, {
    _id,
    count
  }) => {
    /* istanbul ignore next */
    cov_qiqd1fki6().f[9]++;
    cov_qiqd1fki6().s[44]++;
    map[_id] = count;
    /* istanbul ignore next */
    cov_qiqd1fki6().s[45]++;
    return map;
  }, {}));
  // Ensure all ratings 1-5 are represented, with missing ones set to count: 0
  const ratingDistribution =
  /* istanbul ignore next */
  (cov_qiqd1fki6().s[46]++, []);
  /* istanbul ignore next */
  cov_qiqd1fki6().s[47]++;
  for (let i =
  /* istanbul ignore next */
  (cov_qiqd1fki6().s[48]++, 1); i <= 5; i++) {
    /* istanbul ignore next */
    cov_qiqd1fki6().s[49]++;
    ratingDistribution.push({
      rating: i,
      count:
      /* istanbul ignore next */
      (cov_qiqd1fki6().b[4][0]++, ratingMap[i]) ||
      /* istanbul ignore next */
      (cov_qiqd1fki6().b[4][1]++, 0)
    });
  }
  // Update product fields with calculated values
  /* istanbul ignore next */
  cov_qiqd1fki6().s[50]++;
  await _productmodel.default.findByIdAndUpdate(productId, {
    avgRating: avgRating.toFixed(1),
    numReviews: totalReviews,
    ratingDistribution
  });
};
async function getReviews({
  productId,
  limit,
  page
}) {
  /* istanbul ignore next */
  cov_qiqd1fki6().f[10]++;
  const {
    common: {
      pageSize
    }
  } =
  /* istanbul ignore next */
  (cov_qiqd1fki6().s[51]++, await (0, _settingactions.getSetting)());
  /* istanbul ignore next */
  cov_qiqd1fki6().s[52]++;
  limit =
  /* istanbul ignore next */
  (cov_qiqd1fki6().b[5][0]++, limit) ||
  /* istanbul ignore next */
  (cov_qiqd1fki6().b[5][1]++, pageSize);
  /* istanbul ignore next */
  cov_qiqd1fki6().s[53]++;
  await (0, _db.connectToDatabase)();
  const skipAmount =
  /* istanbul ignore next */
  (cov_qiqd1fki6().s[54]++, (page - 1) * limit);
  const reviews =
  /* istanbul ignore next */
  (cov_qiqd1fki6().s[55]++, await _reviewmodel.default.find({
    product: productId
  }).populate('user', 'name').sort({
    createdAt: 'desc'
  }).skip(skipAmount).limit(limit));
  const reviewsCount =
  /* istanbul ignore next */
  (cov_qiqd1fki6().s[56]++, await _reviewmodel.default.countDocuments({
    product: productId
  }));
  /* istanbul ignore next */
  cov_qiqd1fki6().s[57]++;
  return {
    data: JSON.parse(JSON.stringify(reviews)),
    totalPages: reviewsCount === 0 ?
    /* istanbul ignore next */
    (cov_qiqd1fki6().b[6][0]++, 1) :
    /* istanbul ignore next */
    (cov_qiqd1fki6().b[6][1]++, Math.ceil(reviewsCount / limit))
  };
}
/* istanbul ignore next */
cov_qiqd1fki6().s[58]++;
const getReviewByProductId = async ({
  productId
}) => {
  /* istanbul ignore next */
  cov_qiqd1fki6().f[11]++;
  cov_qiqd1fki6().s[59]++;
  await (0, _db.connectToDatabase)();
  const session =
  /* istanbul ignore next */
  (cov_qiqd1fki6().s[60]++, await (0, _auth.auth)());
  /* istanbul ignore next */
  cov_qiqd1fki6().s[61]++;
  if (!session) {
    /* istanbul ignore next */
    cov_qiqd1fki6().b[7][0]++;
    cov_qiqd1fki6().s[62]++;
    throw new Error('User is not authenticated');
  } else
  /* istanbul ignore next */
  {
    cov_qiqd1fki6().b[7][1]++;
  }
  const review =
  /* istanbul ignore next */
  (cov_qiqd1fki6().s[63]++, await _reviewmodel.default.findOne({
    product: productId,
    user: session?.user?.id
  }));
  /* istanbul ignore next */
  cov_qiqd1fki6().s[64]++;
  return review ?
  /* istanbul ignore next */
  (cov_qiqd1fki6().b[8][0]++, JSON.parse(JSON.stringify(review))) :
  /* istanbul ignore next */
  (cov_qiqd1fki6().b[8][1]++, null);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfcWlxZDFma2k2IiwiYWN0dWFsQ292ZXJhZ2UiLCJzIiwiY3JlYXRlVXBkYXRlUmV2aWV3IiwiZiIsImdldFJldmlld0J5UHJvZHVjdElkIiwiZ2V0UmV2aWV3cyIsImRhdGEiLCJwYXRoIiwic2Vzc2lvbiIsIl9hdXRoIiwiYXV0aCIsImIiLCJFcnJvciIsInJldmlldyIsIl92YWxpZGF0b3IiLCJSZXZpZXdJbnB1dFNjaGVtYSIsInBhcnNlIiwidXNlciIsImlkIiwiX2RiIiwiY29ubmVjdFRvRGF0YWJhc2UiLCJleGlzdFJldmlldyIsIl9yZXZpZXdtb2RlbCIsImRlZmF1bHQiLCJmaW5kT25lIiwicHJvZHVjdCIsImNvbW1lbnQiLCJyYXRpbmciLCJ0aXRsZSIsInNhdmUiLCJ1cGRhdGVQcm9kdWN0UmV2aWV3IiwiX2NhY2hlIiwicmV2YWxpZGF0ZVBhdGgiLCJzdWNjZXNzIiwibWVzc2FnZSIsImNyZWF0ZSIsImVycm9yIiwiX3V0aWxzIiwiZm9ybWF0RXJyb3IiLCJwcm9kdWN0SWQiLCJyZXN1bHQiLCJhZ2dyZWdhdGUiLCIkbWF0Y2giLCJfbW9uZ29vc2UiLCJUeXBlcyIsIk9iamVjdElkIiwiJGdyb3VwIiwiX2lkIiwiY291bnQiLCIkc3VtIiwidG90YWxSZXZpZXdzIiwicmVkdWNlIiwic3VtIiwiYXZnUmF0aW5nIiwicmF0aW5nTWFwIiwibWFwIiwicmF0aW5nRGlzdHJpYnV0aW9uIiwiaSIsInB1c2giLCJfcHJvZHVjdG1vZGVsIiwiZmluZEJ5SWRBbmRVcGRhdGUiLCJ0b0ZpeGVkIiwibnVtUmV2aWV3cyIsImxpbWl0IiwicGFnZSIsImNvbW1vbiIsInBhZ2VTaXplIiwiX3NldHRpbmdhY3Rpb25zIiwiZ2V0U2V0dGluZyIsInNraXBBbW91bnQiLCJyZXZpZXdzIiwiZmluZCIsInBvcHVsYXRlIiwic29ydCIsImNyZWF0ZWRBdCIsInNraXAiLCJyZXZpZXdzQ291bnQiLCJjb3VudERvY3VtZW50cyIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0b3RhbFBhZ2VzIiwiTWF0aCIsImNlaWwiXSwic291cmNlcyI6WyIvaG9tZS9oYWdlci9uZXcvbXktbmV4dGpzLXByb2plY3QtbWFzdGVyICgzKS9teS1uZXh0anMtcHJvamVjdC1tYXN0ZXIvbGliL2FjdGlvbnMvcmV2aWV3LmFjdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzZXJ2ZXInXG5cbmltcG9ydCBtb25nb29zZSBmcm9tICdtb25nb29zZSdcbmltcG9ydCB7IHJldmFsaWRhdGVQYXRoIH0gZnJvbSAnbmV4dC9jYWNoZSdcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnXG5cbmltcG9ydCB7IGF1dGggfSBmcm9tICdAL2F1dGgnXG5cbmltcG9ydCB7IGNvbm5lY3RUb0RhdGFiYXNlIH0gZnJvbSAnLi4vZGInXG5pbXBvcnQgUHJvZHVjdCBmcm9tICcuLi9kYi9tb2RlbHMvcHJvZHVjdC5tb2RlbCdcbmltcG9ydCBSZXZpZXcsIHsgSVJldmlldyB9IGZyb20gJy4uL2RiL21vZGVscy9yZXZpZXcubW9kZWwnXG5pbXBvcnQgeyBmb3JtYXRFcnJvciB9IGZyb20gJy4uL3V0aWxzJ1xuaW1wb3J0IHsgUmV2aWV3SW5wdXRTY2hlbWEgfSBmcm9tICcuLi92YWxpZGF0b3InXG5pbXBvcnQgeyBJUmV2aWV3RGV0YWlscyB9IGZyb20gJ0AvdHlwZXMnXG5pbXBvcnQgeyBnZXRTZXR0aW5nIH0gZnJvbSAnLi9zZXR0aW5nLmFjdGlvbnMnXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVVcGRhdGVSZXZpZXcoe1xuICBkYXRhLFxuICBwYXRoLFxufToge1xuICBkYXRhOiB6LmluZmVyPHR5cGVvZiBSZXZpZXdJbnB1dFNjaGVtYT5cbiAgcGF0aDogc3RyaW5nXG59KSB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGgoKVxuICAgIGlmICghc2Vzc2lvbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc2VyIGlzIG5vdCBhdXRoZW50aWNhdGVkJylcbiAgICB9XG5cbiAgICBjb25zdCByZXZpZXcgPSBSZXZpZXdJbnB1dFNjaGVtYS5wYXJzZSh7XG4gICAgICAuLi5kYXRhLFxuICAgICAgdXNlcjogc2Vzc2lvbj8udXNlcj8uaWQsXG4gICAgfSlcblxuICAgIGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKClcbiAgICBjb25zdCBleGlzdFJldmlldyA9IGF3YWl0IFJldmlldy5maW5kT25lKHtcbiAgICAgIHByb2R1Y3Q6IHJldmlldy5wcm9kdWN0LFxuICAgICAgdXNlcjogcmV2aWV3LnVzZXIsXG4gICAgfSlcblxuICAgIGlmIChleGlzdFJldmlldykge1xuICAgICAgZXhpc3RSZXZpZXcuY29tbWVudCA9IHJldmlldy5jb21tZW50XG4gICAgICBleGlzdFJldmlldy5yYXRpbmcgPSByZXZpZXcucmF0aW5nXG4gICAgICBleGlzdFJldmlldy50aXRsZSA9IHJldmlldy50aXRsZVxuICAgICAgYXdhaXQgZXhpc3RSZXZpZXcuc2F2ZSgpXG4gICAgICBhd2FpdCB1cGRhdGVQcm9kdWN0UmV2aWV3KHJldmlldy5wcm9kdWN0KVxuICAgICAgcmV2YWxpZGF0ZVBhdGgocGF0aClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICdSZXZpZXcgdXBkYXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICAvLyBkYXRhOiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGV4aXN0UmV2aWV3KSksXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IFJldmlldy5jcmVhdGUocmV2aWV3KVxuICAgICAgYXdhaXQgdXBkYXRlUHJvZHVjdFJldmlldyhyZXZpZXcucHJvZHVjdClcbiAgICAgIHJldmFsaWRhdGVQYXRoKHBhdGgpXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnUmV2aWV3IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgLy8gZGF0YTogSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShuZXdSZXZpZXcpKSxcbiAgICAgIH1cbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogZm9ybWF0RXJyb3IoZXJyb3IpLFxuICAgIH1cbiAgfVxufVxuXG5jb25zdCB1cGRhdGVQcm9kdWN0UmV2aWV3ID0gYXN5bmMgKHByb2R1Y3RJZDogc3RyaW5nKSA9PiB7XG4gIC8vIENhbGN1bGF0ZSB0aGUgbmV3IGF2ZXJhZ2UgcmF0aW5nLCBudW1iZXIgb2YgcmV2aWV3cywgYW5kIHJhdGluZyBkaXN0cmlidXRpb25cbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUmV2aWV3LmFnZ3JlZ2F0ZShbXG4gICAgeyAkbWF0Y2g6IHsgcHJvZHVjdDogbmV3IG1vbmdvb3NlLlR5cGVzLk9iamVjdElkKHByb2R1Y3RJZCkgfSB9LFxuICAgIHtcbiAgICAgICRncm91cDoge1xuICAgICAgICBfaWQ6ICckcmF0aW5nJyxcbiAgICAgICAgY291bnQ6IHsgJHN1bTogMSB9LFxuICAgICAgfSxcbiAgICB9LFxuICBdKVxuICAvLyBDYWxjdWxhdGUgdGhlIHRvdGFsIG51bWJlciBvZiByZXZpZXdzIGFuZCBhdmVyYWdlIHJhdGluZ1xuICBjb25zdCB0b3RhbFJldmlld3MgPSByZXN1bHQucmVkdWNlKChzdW0sIHsgY291bnQgfSkgPT4gc3VtICsgY291bnQsIDApXG4gIGNvbnN0IGF2Z1JhdGluZyA9XG4gICAgcmVzdWx0LnJlZHVjZSgoc3VtLCB7IF9pZCwgY291bnQgfSkgPT4gc3VtICsgX2lkICogY291bnQsIDApIC8gdG90YWxSZXZpZXdzXG5cbiAgLy8gQ29udmVydCBhZ2dyZWdhdGlvbiByZXN1bHQgdG8gYSBtYXAgZm9yIGVhc2llciBsb29rdXBcbiAgY29uc3QgcmF0aW5nTWFwID0gcmVzdWx0LnJlZHVjZSgobWFwLCB7IF9pZCwgY291bnQgfSkgPT4ge1xuICAgIG1hcFtfaWRdID0gY291bnRcbiAgICByZXR1cm4gbWFwXG4gIH0sIHt9KVxuICAvLyBFbnN1cmUgYWxsIHJhdGluZ3MgMS01IGFyZSByZXByZXNlbnRlZCwgd2l0aCBtaXNzaW5nIG9uZXMgc2V0IHRvIGNvdW50OiAwXG4gIGNvbnN0IHJhdGluZ0Rpc3RyaWJ1dGlvbiA9IFtdXG4gIGZvciAobGV0IGkgPSAxOyBpIDw9IDU7IGkrKykge1xuICAgIHJhdGluZ0Rpc3RyaWJ1dGlvbi5wdXNoKHsgcmF0aW5nOiBpLCBjb3VudDogcmF0aW5nTWFwW2ldIHx8IDAgfSlcbiAgfVxuICAvLyBVcGRhdGUgcHJvZHVjdCBmaWVsZHMgd2l0aCBjYWxjdWxhdGVkIHZhbHVlc1xuICBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkQW5kVXBkYXRlKHByb2R1Y3RJZCwge1xuICAgIGF2Z1JhdGluZzogYXZnUmF0aW5nLnRvRml4ZWQoMSksXG4gICAgbnVtUmV2aWV3czogdG90YWxSZXZpZXdzLFxuICAgIHJhdGluZ0Rpc3RyaWJ1dGlvbixcbiAgfSlcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFJldmlld3Moe1xuICBwcm9kdWN0SWQsXG4gIGxpbWl0LFxuICBwYWdlLFxufToge1xuICBwcm9kdWN0SWQ6IHN0cmluZ1xuICBsaW1pdD86IG51bWJlclxuICBwYWdlOiBudW1iZXJcbn0pIHtcbiAgY29uc3Qge1xuICAgIGNvbW1vbjogeyBwYWdlU2l6ZSB9LFxuICB9ID0gYXdhaXQgZ2V0U2V0dGluZygpXG4gIGxpbWl0ID0gbGltaXQgfHwgcGFnZVNpemVcbiAgYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKVxuICBjb25zdCBza2lwQW1vdW50ID0gKHBhZ2UgLSAxKSAqIGxpbWl0XG4gIGNvbnN0IHJldmlld3MgPSBhd2FpdCBSZXZpZXcuZmluZCh7IHByb2R1Y3Q6IHByb2R1Y3RJZCB9KVxuICAgIC5wb3B1bGF0ZSgndXNlcicsICduYW1lJylcbiAgICAuc29ydCh7XG4gICAgICBjcmVhdGVkQXQ6ICdkZXNjJyxcbiAgICB9KVxuICAgIC5za2lwKHNraXBBbW91bnQpXG4gICAgLmxpbWl0KGxpbWl0KVxuICBjb25zdCByZXZpZXdzQ291bnQgPSBhd2FpdCBSZXZpZXcuY291bnREb2N1bWVudHMoeyBwcm9kdWN0OiBwcm9kdWN0SWQgfSlcbiAgcmV0dXJuIHtcbiAgICBkYXRhOiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJldmlld3MpKSBhcyBJUmV2aWV3RGV0YWlsc1tdLFxuICAgIHRvdGFsUGFnZXM6IHJldmlld3NDb3VudCA9PT0gMCA/IDEgOiBNYXRoLmNlaWwocmV2aWV3c0NvdW50IC8gbGltaXQpLFxuICB9XG59XG5leHBvcnQgY29uc3QgZ2V0UmV2aWV3QnlQcm9kdWN0SWQgPSBhc3luYyAoe1xuICBwcm9kdWN0SWQsXG59OiB7XG4gIHByb2R1Y3RJZDogc3RyaW5nXG59KSA9PiB7XG4gIGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKClcbiAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGgoKVxuICBpZiAoIXNlc3Npb24pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgaXMgbm90IGF1dGhlbnRpY2F0ZWQnKVxuICB9XG4gIGNvbnN0IHJldmlldyA9IGF3YWl0IFJldmlldy5maW5kT25lKHtcbiAgICBwcm9kdWN0OiBwcm9kdWN0SWQsXG4gICAgdXNlcjogc2Vzc2lvbj8udXNlcj8uaWQsXG4gIH0pXG4gIHJldHVybiByZXZpZXcgPyAoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXZpZXcpKSBhcyBJUmV2aWV3KSA6IG51bGxcbn1cbiJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFvSWE7SUFBQUEsYUFBQSxZQUFBQSxDQUFBO01BQUEsT0FBQUMsY0FBQTtJQUFBO0VBQUE7RUFBQSxPQUFBQSxjQUFBO0FBQUE7QUFBQUQsYUFBQTtBQUFBQSxhQUFBLEdBQUFFLENBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0VBcEhTQyxrQkFBa0IsV0FBQUEsQ0FBQTtJQUFBO0lBQUFILGFBQUEsR0FBQUksQ0FBQTtJQUFBSixhQUFBLEdBQUFFLENBQUE7V0FBbEJDLGtCQUFBOztFQW9IVEUsb0JBQW9CLFdBQUFBLENBQUE7SUFBQTtJQUFBTCxhQUFBLEdBQUFJLENBQUE7SUFBQUosYUFBQSxHQUFBRSxDQUFBO1dBQXBCRyxvQkFBQTs7RUE1QlNDLFVBQVUsV0FBQUEsQ0FBQTtJQUFBO0lBQUFOLGFBQUEsR0FBQUksQ0FBQTtJQUFBSixhQUFBLEdBQUFFLENBQUE7V0FBVkksVUFBQTs7Ozs7dUVBdEdEOzs7aUNBQ1U7OztpQ0FHVjs7O2tDQUVhOzs7d0VBQ2Q7Ozt3RUFDWTs7O2tDQUNKOzs7a0NBQ007OztrQ0FFUDs7Ozs7Ozs7Ozs7Ozs7O0FBRXBCLGVBQWVILG1CQUFtQjtFQUN2Q0ksSUFBSTtFQUNKQztBQUFJLENBSUw7RUFBQTtFQUFBUixhQUFBLEdBQUFJLENBQUE7RUFBQUosYUFBQSxHQUFBRSxDQUFBO0VBQ0MsSUFBSTtJQUNGLE1BQU1PLE9BQUE7SUFBQTtJQUFBLENBQUFULGFBQUEsR0FBQUUsQ0FBQSxRQUFVLE1BQU0sSUFBQVEsS0FBQSxDQUFBQyxJQUFJO0lBQUE7SUFBQVgsYUFBQSxHQUFBRSxDQUFBO0lBQzFCLElBQUksQ0FBQ08sT0FBQSxFQUFTO01BQUE7TUFBQVQsYUFBQSxHQUFBWSxDQUFBO01BQUFaLGFBQUEsR0FBQUUsQ0FBQTtNQUNaLE1BQU0sSUFBSVcsS0FBQSxDQUFNO0lBQ2xCO0lBQUE7SUFBQTtNQUFBYixhQUFBLEdBQUFZLENBQUE7SUFBQTtJQUVBLE1BQU1FLE1BQUE7SUFBQTtJQUFBLENBQUFkLGFBQUEsR0FBQUUsQ0FBQSxRQUFTYSxVQUFBLENBQUFDLGlCQUFpQixDQUFDQyxLQUFLLENBQUM7TUFDckMsR0FBR1YsSUFBSTtNQUNQVyxJQUFBLEVBQU1ULE9BQUEsRUFBU1MsSUFBQSxFQUFNQztJQUN2QjtJQUFBO0lBQUFuQixhQUFBLEdBQUFFLENBQUE7SUFFQSxNQUFNLElBQUFrQixHQUFBLENBQUFDLGlCQUFpQjtJQUN2QixNQUFNQyxXQUFBO0lBQUE7SUFBQSxDQUFBdEIsYUFBQSxHQUFBRSxDQUFBLFFBQWMsTUFBTXFCLFlBQUEsQ0FBQUMsT0FBTSxDQUFDQyxPQUFPLENBQUM7TUFDdkNDLE9BQUEsRUFBU1osTUFBQSxDQUFPWSxPQUFPO01BQ3ZCUixJQUFBLEVBQU1KLE1BQUEsQ0FBT0k7SUFDZjtJQUFBO0lBQUFsQixhQUFBLEdBQUFFLENBQUE7SUFFQSxJQUFJb0IsV0FBQSxFQUFhO01BQUE7TUFBQXRCLGFBQUEsR0FBQVksQ0FBQTtNQUFBWixhQUFBLEdBQUFFLENBQUE7TUFDZm9CLFdBQUEsQ0FBWUssT0FBTyxHQUFHYixNQUFBLENBQU9hLE9BQU87TUFBQTtNQUFBM0IsYUFBQSxHQUFBRSxDQUFBO01BQ3BDb0IsV0FBQSxDQUFZTSxNQUFNLEdBQUdkLE1BQUEsQ0FBT2MsTUFBTTtNQUFBO01BQUE1QixhQUFBLEdBQUFFLENBQUE7TUFDbENvQixXQUFBLENBQVlPLEtBQUssR0FBR2YsTUFBQSxDQUFPZSxLQUFLO01BQUE7TUFBQTdCLGFBQUEsR0FBQUUsQ0FBQTtNQUNoQyxNQUFNb0IsV0FBQSxDQUFZUSxJQUFJO01BQUE7TUFBQTlCLGFBQUEsR0FBQUUsQ0FBQTtNQUN0QixNQUFNNkIsbUJBQUEsQ0FBb0JqQixNQUFBLENBQU9ZLE9BQU87TUFBQTtNQUFBMUIsYUFBQSxHQUFBRSxDQUFBO01BQ3hDLElBQUE4QixNQUFBLENBQUFDLGNBQWMsRUFBQ3pCLElBQUE7TUFBQTtNQUFBUixhQUFBLEdBQUFFLENBQUE7TUFDZixPQUFPO1FBQ0xnQyxPQUFBLEVBQVM7UUFDVEMsT0FBQSxFQUFTO01BRVg7SUFDRixPQUFPO01BQUE7TUFBQW5DLGFBQUEsR0FBQVksQ0FBQTtNQUFBWixhQUFBLEdBQUFFLENBQUE7TUFDTCxNQUFNcUIsWUFBQSxDQUFBQyxPQUFNLENBQUNZLE1BQU0sQ0FBQ3RCLE1BQUE7TUFBQTtNQUFBZCxhQUFBLEdBQUFFLENBQUE7TUFDcEIsTUFBTTZCLG1CQUFBLENBQW9CakIsTUFBQSxDQUFPWSxPQUFPO01BQUE7TUFBQTFCLGFBQUEsR0FBQUUsQ0FBQTtNQUN4QyxJQUFBOEIsTUFBQSxDQUFBQyxjQUFjLEVBQUN6QixJQUFBO01BQUE7TUFBQVIsYUFBQSxHQUFBRSxDQUFBO01BQ2YsT0FBTztRQUNMZ0MsT0FBQSxFQUFTO1FBQ1RDLE9BQUEsRUFBUztNQUVYO0lBQ0Y7RUFDRixFQUFFLE9BQU9FLEtBQUEsRUFBTztJQUFBO0lBQUFyQyxhQUFBLEdBQUFFLENBQUE7SUFDZCxPQUFPO01BQ0xnQyxPQUFBLEVBQVM7TUFDVEMsT0FBQSxFQUFTLElBQUFHLE1BQUEsQ0FBQUMsV0FBVyxFQUFDRixLQUFBO0lBQ3ZCO0VBQ0Y7QUFDRjtBQUFBO0FBQUFyQyxhQUFBLEdBQUFFLENBQUE7QUFFQSxNQUFNNkIsbUJBQUEsR0FBc0IsTUFBT1MsU0FBQTtFQUFBO0VBQUF4QyxhQUFBLEdBQUFJLENBQUE7RUFDakM7RUFDQSxNQUFNcUMsTUFBQTtFQUFBO0VBQUEsQ0FBQXpDLGFBQUEsR0FBQUUsQ0FBQSxRQUFTLE1BQU1xQixZQUFBLENBQUFDLE9BQU0sQ0FBQ2tCLFNBQVMsQ0FBQyxDQUNwQztJQUFFQyxNQUFBLEVBQVE7TUFBRWpCLE9BQUEsRUFBUyxJQUFJa0IsU0FBQSxDQUFBcEIsT0FBUSxDQUFDcUIsS0FBSyxDQUFDQyxRQUFRLENBQUNOLFNBQUE7SUFBVztFQUFFLEdBQzlEO0lBQ0VPLE1BQUEsRUFBUTtNQUNOQyxHQUFBLEVBQUs7TUFDTEMsS0FBQSxFQUFPO1FBQUVDLElBQUEsRUFBTTtNQUFFO0lBQ25CO0VBQ0YsRUFDRDtFQUNEO0VBQ0EsTUFBTUMsWUFBQTtFQUFBO0VBQUEsQ0FBQW5ELGFBQUEsR0FBQUUsQ0FBQSxRQUFldUMsTUFBQSxDQUFPVyxNQUFNLENBQUMsQ0FBQ0MsR0FBQSxFQUFLO0lBQUVKO0VBQUssQ0FBRSxLQUFLO0lBQUE7SUFBQWpELGFBQUEsR0FBQUksQ0FBQTtJQUFBSixhQUFBLEdBQUFFLENBQUE7SUFBQSxPQUFBbUQsR0FBQSxHQUFNSixLQUFBO0VBQUEsR0FBTztFQUNwRSxNQUFNSyxTQUFBO0VBQUE7RUFBQSxDQUFBdEQsYUFBQSxHQUFBRSxDQUFBLFFBQ0p1QyxNQUFBLENBQU9XLE1BQU0sQ0FBQyxDQUFDQyxHQUFBLEVBQUs7SUFBRUwsR0FBRztJQUFFQztFQUFLLENBQUUsS0FBSztJQUFBO0lBQUFqRCxhQUFBLEdBQUFJLENBQUE7SUFBQUosYUFBQSxHQUFBRSxDQUFBO0lBQUEsT0FBQW1ELEdBQUEsR0FBTUwsR0FBQSxHQUFNQyxLQUFBO0VBQUEsR0FBTyxLQUFLRSxZQUFBO0VBRWpFO0VBQ0EsTUFBTUksU0FBQTtFQUFBO0VBQUEsQ0FBQXZELGFBQUEsR0FBQUUsQ0FBQSxRQUFZdUMsTUFBQSxDQUFPVyxNQUFNLENBQUMsQ0FBQ0ksR0FBQSxFQUFLO0lBQUVSLEdBQUc7SUFBRUM7RUFBSyxDQUFFO0lBQUE7SUFBQWpELGFBQUEsR0FBQUksQ0FBQTtJQUFBSixhQUFBLEdBQUFFLENBQUE7SUFDbERzRCxHQUFHLENBQUNSLEdBQUEsQ0FBSSxHQUFHQyxLQUFBO0lBQUE7SUFBQWpELGFBQUEsR0FBQUUsQ0FBQTtJQUNYLE9BQU9zRCxHQUFBO0VBQ1QsR0FBRyxDQUFDO0VBQ0o7RUFDQSxNQUFNQyxrQkFBQTtFQUFBO0VBQUEsQ0FBQXpELGFBQUEsR0FBQUUsQ0FBQSxRQUFxQixFQUFFO0VBQUE7RUFBQUYsYUFBQSxHQUFBRSxDQUFBO0VBQzdCLEtBQUssSUFBSXdELENBQUE7RUFBQTtFQUFBLENBQUExRCxhQUFBLEdBQUFFLENBQUEsUUFBSSxJQUFHd0QsQ0FBQSxJQUFLLEdBQUdBLENBQUEsSUFBSztJQUFBO0lBQUExRCxhQUFBLEdBQUFFLENBQUE7SUFDM0J1RCxrQkFBQSxDQUFtQkUsSUFBSSxDQUFDO01BQUUvQixNQUFBLEVBQVE4QixDQUFBO01BQUdULEtBQUE7TUFBTztNQUFBLENBQUFqRCxhQUFBLEdBQUFZLENBQUEsVUFBQTJDLFNBQVMsQ0FBQ0csQ0FBQSxDQUFFO01BQUE7TUFBQSxDQUFBMUQsYUFBQSxHQUFBWSxDQUFBLFVBQUk7SUFBRTtFQUNoRTtFQUNBO0VBQUE7RUFBQVosYUFBQSxHQUFBRSxDQUFBO0VBQ0EsTUFBTTBELGFBQUEsQ0FBQXBDLE9BQU8sQ0FBQ3FDLGlCQUFpQixDQUFDckIsU0FBQSxFQUFXO0lBQ3pDYyxTQUFBLEVBQVdBLFNBQUEsQ0FBVVEsT0FBTyxDQUFDO0lBQzdCQyxVQUFBLEVBQVlaLFlBQUE7SUFDWk07RUFDRjtBQUNGO0FBRU8sZUFBZW5ELFdBQVc7RUFDL0JrQyxTQUFTO0VBQ1R3QixLQUFLO0VBQ0xDO0FBQUksQ0FLTDtFQUFBO0VBQUFqRSxhQUFBLEdBQUFJLENBQUE7RUFDQyxNQUFNO0lBQ0o4RCxNQUFBLEVBQVE7TUFBRUM7SUFBUTtFQUFFLENBQ3JCO0VBQUE7RUFBQSxDQUFBbkUsYUFBQSxHQUFBRSxDQUFBLFFBQUcsTUFBTSxJQUFBa0UsZUFBQSxDQUFBQyxVQUFVO0VBQUE7RUFBQXJFLGFBQUEsR0FBQUUsQ0FBQTtFQUNwQjhELEtBQUE7RUFBUTtFQUFBLENBQUFoRSxhQUFBLEdBQUFZLENBQUEsVUFBQW9ELEtBQUE7RUFBQTtFQUFBLENBQUFoRSxhQUFBLEdBQUFZLENBQUEsVUFBU3VELFFBQUE7RUFBQTtFQUFBbkUsYUFBQSxHQUFBRSxDQUFBO0VBQ2pCLE1BQU0sSUFBQWtCLEdBQUEsQ0FBQUMsaUJBQWlCO0VBQ3ZCLE1BQU1pRCxVQUFBO0VBQUE7RUFBQSxDQUFBdEUsYUFBQSxHQUFBRSxDQUFBLFFBQWEsQ0FBQytELElBQUEsR0FBTyxLQUFLRCxLQUFBO0VBQ2hDLE1BQU1PLE9BQUE7RUFBQTtFQUFBLENBQUF2RSxhQUFBLEdBQUFFLENBQUEsUUFBVSxNQUFNcUIsWUFBQSxDQUFBQyxPQUFNLENBQUNnRCxJQUFJLENBQUM7SUFBRTlDLE9BQUEsRUFBU2M7RUFBVSxHQUNwRGlDLFFBQVEsQ0FBQyxRQUFRLFFBQ2pCQyxJQUFJLENBQUM7SUFDSkMsU0FBQSxFQUFXO0VBQ2IsR0FDQ0MsSUFBSSxDQUFDTixVQUFBLEVBQ0xOLEtBQUssQ0FBQ0EsS0FBQTtFQUNULE1BQU1hLFlBQUE7RUFBQTtFQUFBLENBQUE3RSxhQUFBLEdBQUFFLENBQUEsUUFBZSxNQUFNcUIsWUFBQSxDQUFBQyxPQUFNLENBQUNzRCxjQUFjLENBQUM7SUFBRXBELE9BQUEsRUFBU2M7RUFBVTtFQUFBO0VBQUF4QyxhQUFBLEdBQUFFLENBQUE7RUFDdEUsT0FBTztJQUNMSyxJQUFBLEVBQU13RSxJQUFBLENBQUs5RCxLQUFLLENBQUM4RCxJQUFBLENBQUtDLFNBQVMsQ0FBQ1QsT0FBQTtJQUNoQ1UsVUFBQSxFQUFZSixZQUFBLEtBQWlCO0lBQUE7SUFBQSxDQUFBN0UsYUFBQSxHQUFBWSxDQUFBLFVBQUk7SUFBQTtJQUFBLENBQUFaLGFBQUEsR0FBQVksQ0FBQSxVQUFJc0UsSUFBQSxDQUFLQyxJQUFJLENBQUNOLFlBQUEsR0FBZWIsS0FBQTtFQUNoRTtBQUNGO0FBQUE7QUFBQWhFLGFBQUEsR0FBQUUsQ0FBQTtBQUNPLE1BQU1HLG9CQUFBLEdBQXVCLE1BQUFBLENBQU87RUFDekNtQztBQUFTLENBR1Y7RUFBQTtFQUFBeEMsYUFBQSxHQUFBSSxDQUFBO0VBQUFKLGFBQUEsR0FBQUUsQ0FBQTtFQUNDLE1BQU0sSUFBQWtCLEdBQUEsQ0FBQUMsaUJBQWlCO0VBQ3ZCLE1BQU1aLE9BQUE7RUFBQTtFQUFBLENBQUFULGFBQUEsR0FBQUUsQ0FBQSxRQUFVLE1BQU0sSUFBQVEsS0FBQSxDQUFBQyxJQUFJO0VBQUE7RUFBQVgsYUFBQSxHQUFBRSxDQUFBO0VBQzFCLElBQUksQ0FBQ08sT0FBQSxFQUFTO0lBQUE7SUFBQVQsYUFBQSxHQUFBWSxDQUFBO0lBQUFaLGFBQUEsR0FBQUUsQ0FBQTtJQUNaLE1BQU0sSUFBSVcsS0FBQSxDQUFNO0VBQ2xCO0VBQUE7RUFBQTtJQUFBYixhQUFBLEdBQUFZLENBQUE7RUFBQTtFQUNBLE1BQU1FLE1BQUE7RUFBQTtFQUFBLENBQUFkLGFBQUEsR0FBQUUsQ0FBQSxRQUFTLE1BQU1xQixZQUFBLENBQUFDLE9BQU0sQ0FBQ0MsT0FBTyxDQUFDO0lBQ2xDQyxPQUFBLEVBQVNjLFNBQUE7SUFDVHRCLElBQUEsRUFBTVQsT0FBQSxFQUFTUyxJQUFBLEVBQU1DO0VBQ3ZCO0VBQUE7RUFBQW5CLGFBQUEsR0FBQUUsQ0FBQTtFQUNBLE9BQU9ZLE1BQUE7RUFBQTtFQUFBLENBQUFkLGFBQUEsR0FBQVksQ0FBQSxVQUFVbUUsSUFBQSxDQUFLOUQsS0FBSyxDQUFDOEQsSUFBQSxDQUFLQyxTQUFTLENBQUNsRSxNQUFBO0VBQUE7RUFBQSxDQUFBZCxhQUFBLEdBQUFZLENBQUEsVUFBdUI7QUFDcEUiLCJpZ25vcmVMaXN0IjpbXX0=