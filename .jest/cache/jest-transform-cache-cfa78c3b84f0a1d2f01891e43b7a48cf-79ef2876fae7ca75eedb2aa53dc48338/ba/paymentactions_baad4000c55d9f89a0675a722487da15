9dd7477f06adc11572d92334e6184e8a
"use strict";

/* istanbul ignore next */
function cov_oeny05toy() {
  var path = "/home/hager/new/my-nextjs-project-master (3)/my-nextjs-project-master/lib/actions/payment.actions.ts";
  var hash = "a45189976edce5ac9e8e55b2f55ede75e1b7b531";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/home/hager/new/my-nextjs-project-master (3)/my-nextjs-project-master/lib/actions/payment.actions.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 5,
          column: 0
        },
        end: {
          line: 10,
          column: 3
        }
      },
      "2": {
        start: {
          line: 8,
          column: 8
        },
        end: {
          line: 8,
          column: 31
        }
      },
      "3": {
        start: {
          line: 11,
          column: 18
        },
        end: {
          line: 11,
          column: 46
        }
      },
      "4": {
        start: {
          line: 12,
          column: 31
        },
        end: {
          line: 12,
          column: 84
        }
      },
      "5": {
        start: {
          line: 13,
          column: 12
        },
        end: {
          line: 13,
          column: 28
        }
      },
      "6": {
        start: {
          line: 14,
          column: 35
        },
        end: {
          line: 14,
          column: 97
        }
      },
      "7": {
        start: {
          line: 15,
          column: 33
        },
        end: {
          line: 15,
          column: 93
        }
      },
      "8": {
        start: {
          line: 16,
          column: 22
        },
        end: {
          line: 16,
          column: 54
        }
      },
      "9": {
        start: {
          line: 18,
          column: 4
        },
        end: {
          line: 20,
          column: 6
        }
      },
      "10": {
        start: {
          line: 22,
          column: 0
        },
        end: {
          line: 26,
          column: 3
        }
      },
      "11": {
        start: {
          line: 27,
          column: 15
        },
        end: {
          line: 27,
          column: 83
        }
      },
      "12": {
        start: {
          line: 29,
          column: 69
        },
        end: {
          line: 29,
          column: 76
        }
      },
      "13": {
        start: {
          line: 30,
          column: 4
        },
        end: {
          line: 144,
          column: 5
        }
      },
      "14": {
        start: {
          line: 31,
          column: 8
        },
        end: {
          line: 31,
          column: 43
        }
      },
      "15": {
        start: {
          line: 32,
          column: 23
        },
        end: {
          line: 34,
          column: 17
        }
      },
      "16": {
        start: {
          line: 35,
          column: 8
        },
        end: {
          line: 37,
          column: 9
        }
      },
      "17": {
        start: {
          line: 36,
          column: 12
        },
        end: {
          line: 36,
          column: 48
        }
      },
      "18": {
        start: {
          line: 38,
          column: 21
        },
        end: {
          line: 38,
          column: 88
        }
      },
      "19": {
        start: {
          line: 39,
          column: 25
        },
        end: {
          line: 46,
          column: 9
        }
      },
      "20": {
        start: {
          line: 48,
          column: 8
        },
        end: {
          line: 131,
          column: 9
        }
      },
      "21": {
        start: {
          line: 49,
          column: 12
        },
        end: {
          line: 51,
          column: 13
        }
      },
      "22": {
        start: {
          line: 50,
          column: 16
        },
        end: {
          line: 50,
          column: 58
        }
      },
      "23": {
        start: {
          line: 52,
          column: 28
        },
        end: {
          line: 75,
          column: 14
        }
      },
      "24": {
        start: {
          line: 76,
          column: 12
        },
        end: {
          line: 76,
          column: 44
        }
      },
      "25": {
        start: {
          line: 77,
          column: 12
        },
        end: {
          line: 87,
          column: 15
        }
      },
      "26": {
        start: {
          line: 88,
          column: 15
        },
        end: {
          line: 131,
          column: 9
        }
      },
      "27": {
        start: {
          line: 89,
          column: 38
        },
        end: {
          line: 107,
          column: 13
        }
      },
      "28": {
        start: {
          line: 108,
          column: 12
        },
        end: {
          line: 117,
          column: 15
        }
      },
      "29": {
        start: {
          line: 109,
          column: 16
        },
        end: {
          line: 116,
          column: 19
        }
      },
      "30": {
        start: {
          line: 110,
          column: 20
        },
        end: {
          line: 115,
          column: 21
        }
      },
      "31": {
        start: {
          line: 111,
          column: 24
        },
        end: {
          line: 111,
          column: 38
        }
      },
      "32": {
        start: {
          line: 113,
          column: 44
        },
        end: {
          line: 113,
          column: 106
        }
      },
      "33": {
        start: {
          line: 113,
          column: 72
        },
        end: {
          line: 113,
          column: 99
        }
      },
      "34": {
        start: {
          line: 114,
          column: 24
        },
        end: {
          line: 114,
          column: 51
        }
      },
      "35": {
        start: {
          line: 118,
          column: 12
        },
        end: {
          line: 128,
          column: 15
        }
      },
      "36": {
        start: {
          line: 130,
          column: 12
        },
        end: {
          line: 130,
          column: 58
        }
      },
      "37": {
        start: {
          line: 132,
          column: 8
        },
        end: {
          line: 137,
          column: 10
        }
      },
      "38": {
        start: {
          line: 139,
          column: 8
        },
        end: {
          line: 139,
          column: 58
        }
      },
      "39": {
        start: {
          line: 140,
          column: 8
        },
        end: {
          line: 143,
          column: 10
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 7,
            column: 9
          },
          end: {
            line: 7,
            column: 10
          }
        },
        loc: {
          start: {
            line: 7,
            column: 20
          },
          end: {
            line: 9,
            column: 5
          }
        },
        line: 7
      },
      "1": {
        name: "_interop_require_default",
        decl: {
          start: {
            line: 17,
            column: 9
          },
          end: {
            line: 17,
            column: 33
          }
        },
        loc: {
          start: {
            line: 17,
            column: 39
          },
          end: {
            line: 21,
            column: 1
          }
        },
        line: 17
      },
      "2": {
        name: "initiatePayment",
        decl: {
          start: {
            line: 28,
            column: 15
          },
          end: {
            line: 28,
            column: 30
          }
        },
        loc: {
          start: {
            line: 28,
            column: 40
          },
          end: {
            line: 145,
            column: 1
          }
        },
        line: 28
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 108,
            column: 44
          },
          end: {
            line: 108,
            column: 45
          }
        },
        loc: {
          start: {
            line: 108,
            column: 63
          },
          end: {
            line: 117,
            column: 13
          }
        },
        line: 108
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 109,
            column: 67
          },
          end: {
            line: 109,
            column: 68
          }
        },
        loc: {
          start: {
            line: 109,
            column: 85
          },
          end: {
            line: 116,
            column: 17
          }
        },
        line: 109
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 113,
            column: 64
          },
          end: {
            line: 113,
            column: 65
          }
        },
        loc: {
          start: {
            line: 113,
            column: 72
          },
          end: {
            line: 113,
            column: 99
          }
        },
        line: 113
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 18,
            column: 11
          },
          end: {
            line: 20,
            column: 5
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 18,
            column: 35
          },
          end: {
            line: 18,
            column: 38
          }
        }, {
          start: {
            line: 18,
            column: 41
          },
          end: {
            line: 20,
            column: 5
          }
        }],
        line: 18
      },
      "1": {
        loc: {
          start: {
            line: 18,
            column: 11
          },
          end: {
            line: 18,
            column: 32
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 18,
            column: 11
          },
          end: {
            line: 18,
            column: 14
          }
        }, {
          start: {
            line: 18,
            column: 18
          },
          end: {
            line: 18,
            column: 32
          }
        }],
        line: 18
      },
      "2": {
        loc: {
          start: {
            line: 23,
            column: 10
          },
          end: {
            line: 23,
            column: 46
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 23,
            column: 10
          },
          end: {
            line: 23,
            column: 33
          }
        }, {
          start: {
            line: 23,
            column: 37
          },
          end: {
            line: 23,
            column: 46
          }
        }],
        line: 23
      },
      "3": {
        loc: {
          start: {
            line: 24,
            column: 15
          },
          end: {
            line: 24,
            column: 49
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 24,
            column: 15
          },
          end: {
            line: 24,
            column: 43
          }
        }, {
          start: {
            line: 24,
            column: 47
          },
          end: {
            line: 24,
            column: 49
          }
        }],
        line: 24
      },
      "4": {
        loc: {
          start: {
            line: 25,
            column: 19
          },
          end: {
            line: 25,
            column: 57
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 25,
            column: 19
          },
          end: {
            line: 25,
            column: 51
          }
        }, {
          start: {
            line: 25,
            column: 55
          },
          end: {
            line: 25,
            column: 57
          }
        }],
        line: 25
      },
      "5": {
        loc: {
          start: {
            line: 27,
            column: 47
          },
          end: {
            line: 27,
            column: 82
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 27,
            column: 47
          },
          end: {
            line: 27,
            column: 76
          }
        }, {
          start: {
            line: 27,
            column: 80
          },
          end: {
            line: 27,
            column: 82
          }
        }],
        line: 27
      },
      "6": {
        loc: {
          start: {
            line: 35,
            column: 8
          },
          end: {
            line: 37,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 35,
            column: 8
          },
          end: {
            line: 37,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 35
      },
      "7": {
        loc: {
          start: {
            line: 39,
            column: 25
          },
          end: {
            line: 46,
            column: 9
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 39,
            column: 42
          },
          end: {
            line: 43,
            column: 9
          }
        }, {
          start: {
            line: 43,
            column: 12
          },
          end: {
            line: 46,
            column: 9
          }
        }],
        line: 39
      },
      "8": {
        loc: {
          start: {
            line: 48,
            column: 8
          },
          end: {
            line: 131,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 48,
            column: 8
          },
          end: {
            line: 131,
            column: 9
          }
        }, {
          start: {
            line: 88,
            column: 15
          },
          end: {
            line: 131,
            column: 9
          }
        }],
        line: 48
      },
      "9": {
        loc: {
          start: {
            line: 49,
            column: 12
          },
          end: {
            line: 51,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 49,
            column: 12
          },
          end: {
            line: 51,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 49
      },
      "10": {
        loc: {
          start: {
            line: 76,
            column: 26
          },
          end: {
            line: 76,
            column: 43
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 76,
            column: 26
          },
          end: {
            line: 76,
            column: 37
          }
        }, {
          start: {
            line: 76,
            column: 41
          },
          end: {
            line: 76,
            column: 43
          }
        }],
        line: 76
      },
      "11": {
        loc: {
          start: {
            line: 88,
            column: 15
          },
          end: {
            line: 131,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 88,
            column: 15
          },
          end: {
            line: 131,
            column: 9
          }
        }, {
          start: {
            line: 129,
            column: 15
          },
          end: {
            line: 131,
            column: 9
          }
        }],
        line: 88
      },
      "12": {
        loc: {
          start: {
            line: 110,
            column: 20
          },
          end: {
            line: 115,
            column: 21
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 110,
            column: 20
          },
          end: {
            line: 115,
            column: 21
          }
        }, {
          start: {
            line: 112,
            column: 27
          },
          end: {
            line: 115,
            column: 21
          }
        }],
        line: 110
      },
      "13": {
        loc: {
          start: {
            line: 114,
            column: 32
          },
          end: {
            line: 114,
            column: 49
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 114,
            column: 32
          },
          end: {
            line: 114,
            column: 43
          }
        }, {
          start: {
            line: 114,
            column: 47
          },
          end: {
            line: 114,
            column: 49
          }
        }],
        line: 114
      },
      "14": {
        loc: {
          start: {
            line: 142,
            column: 21
          },
          end: {
            line: 142,
            column: 90
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 142,
            column: 46
          },
          end: {
            line: 142,
            column: 59
          }
        }, {
          start: {
            line: 142,
            column: 62
          },
          end: {
            line: 142,
            column: 90
          }
        }],
        line: 142
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0],
      "13": [0, 0],
      "14": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["/home/hager/new/my-nextjs-project-master (3)/my-nextjs-project-master/lib/actions/payment.actions.ts"],
      sourcesContent: ["import { loadStripe } from '@stripe/stripe-js'\nimport paypal from '@paypal/rest-sdk'\nimport { connectToDatabase } from '@/lib/db'\nimport Seller from '@/lib/db/models/seller.model'\nimport User from '@/lib/db/models/user.model'\nimport { sendNotification } from '@/lib/utils/notification'\n\npaypal.configure({\n  mode: process.env.PAYPAL_MODE || 'sandbox',\n  client_id: process.env.PAYPAL_CLIENT_ID || '',\n  client_secret: process.env.PAYPAL_CLIENT_SECRET || '',\n})\n\nconst stripe = await loadStripe(process.env.STRIPE_SECRET_KEY || '')\n\ninterface PaymentOptions {\n  userId: string\n  amount: number\n  currency: string\n  paymentMethod: 'stripe' | 'paypal'\n  description: string\n}\n\nexport async function initiatePayment(options: PaymentOptions) {\n  const { userId, amount, currency, paymentMethod, description } = options\n\n  try {\n    await connectToDatabase()\n    const seller = await Seller.findOne({ userId }).lean()\n    if (!seller) {\n      throw new Error('Seller not found')\n    }\n\n    const user = await User.findById(userId).select('whatsapp').lean()\n    const channels = user?.whatsapp ? ['email', 'in_app', 'whatsapp'] : ['email', 'in_app']\n\n    let redirectUrl: string\n\n    if (paymentMethod === 'stripe') {\n      if (!stripe) {\n        throw new Error('Stripe not initialized')\n      }\n      const session = await stripe.checkout.sessions.create({\n        payment_method_types: ['card'],\n        line_items: [\n          {\n            price_data: {\n              currency,\n              product_data: { name: description },\n              unit_amount: Math.round(amount * 100),\n            },\n            quantity: 1,\n          },\n        ],\n        mode: 'payment',\n        success_url: `${process.env.NEXT_PUBLIC_BASE_URL}/account/subscriptions?success=true`,\n        cancel_url: `${process.env.NEXT_PUBLIC_BASE_URL}/account/subscriptions?cancelled=true`,\n        metadata: { userId, description },\n      })\n      redirectUrl = session.url || ''\n\n      await sendNotification({\n        userId,\n        type: 'payment_success',\n        title: 'Payment Initiated',\n        message: `Your payment of $${amount} for ${description} has been initiated.`,\n        channels,\n        data: { amount, description },\n      })\n    } else if (paymentMethod === 'paypal') {\n      const createPaymentJson = {\n        intent: 'sale',\n        payer: { payment_method: 'paypal' },\n        redirect_urls: {\n          return_url: `${process.env.NEXT_PUBLIC_BASE_URL}/account/subscriptions?success=true`,\n          cancel_url: `${process.env.NEXT_PUBLIC_BASE_URL}/account/subscriptions?cancelled=true`,\n        },\n        transactions: [\n          {\n            amount: { total: amount.toFixed(2), currency },\n            description,\n          },\n        ],\n      }\n\n      redirectUrl = await new Promise((resolve, reject) => {\n        paypal.payment.create(createPaymentJson, (error, payment) => {\n          if (error) {\n            reject(error)\n          } else {\n            const approvalUrl = payment.links?.find(link => link.rel === 'approval_url')?.href\n            resolve(approvalUrl || '')\n          }\n        })\n      })\n\n      await sendNotification({\n        userId,\n        type: 'payment_success',\n        title: 'Payment Initiated',\n        message: `Your payment of $${amount} for ${description} has been initiated.`,\n        channels,\n        data: { amount, description },\n      })\n    } else {\n      throw new Error('Unsupported payment method')\n    }\n\n    return { success: true, data: { redirectUrl } }\n  } catch (error) {\n    console.error('Payment initiation error:', error)\n    return {\n      success: false,\n      message: error instanceof Error ? error.message : 'Failed to initiate payment',\n    }\n  }\n}"],
      names: ["initiatePayment", "paypal", "configure", "mode", "process", "env", "PAYPAL_MODE", "client_id", "PAYPAL_CLIENT_ID", "client_secret", "PAYPAL_CLIENT_SECRET", "stripe", "loadStripe", "STRIPE_SECRET_KEY", "options", "userId", "amount", "currency", "paymentMethod", "description", "connectToDatabase", "seller", "Seller", "findOne", "lean", "Error", "user", "User", "findById", "select", "channels", "whatsapp", "redirectUrl", "session", "checkout", "sessions", "create", "payment_method_types", "line_items", "price_data", "product_data", "name", "unit_amount", "Math", "round", "quantity", "success_url", "NEXT_PUBLIC_BASE_URL", "cancel_url", "metadata", "url", "sendNotification", "type", "title", "message", "data", "createPaymentJson", "intent", "payer", "payment_method", "redirect_urls", "return_url", "transactions", "total", "toFixed", "Promise", "resolve", "reject", "payment", "error", "approvalUrl", "links", "find", "link", "rel", "href", "success", "console"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "a45189976edce5ac9e8e55b2f55ede75e1b7b531"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_oeny05toy = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_oeny05toy();
cov_oeny05toy().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
/* istanbul ignore next */
cov_oeny05toy().s[1]++;
Object.defineProperty(exports, "initiatePayment", {
  enumerable: true,
  get: function () {
    /* istanbul ignore next */
    cov_oeny05toy().f[0]++;
    cov_oeny05toy().s[2]++;
    return initiatePayment;
  }
});
const _stripejs =
/* istanbul ignore next */
(cov_oeny05toy().s[3]++, require("@stripe/stripe-js"));
const _restsdk =
/* istanbul ignore next */
(/*#__PURE__*/cov_oeny05toy().s[4]++, _interop_require_default(require("@paypal/rest-sdk")));
const _db =
/* istanbul ignore next */
(cov_oeny05toy().s[5]++, require("../db"));
const _sellermodel =
/* istanbul ignore next */
(/*#__PURE__*/cov_oeny05toy().s[6]++, _interop_require_default(require("../db/models/seller.model")));
const _usermodel =
/* istanbul ignore next */
(/*#__PURE__*/cov_oeny05toy().s[7]++, _interop_require_default(require("../db/models/user.model")));
const _notification =
/* istanbul ignore next */
(cov_oeny05toy().s[8]++, require("../utils/notification"));
function _interop_require_default(obj) {
  /* istanbul ignore next */
  cov_oeny05toy().f[1]++;
  cov_oeny05toy().s[9]++;
  return /* istanbul ignore next */(cov_oeny05toy().b[1][0]++, obj) &&
  /* istanbul ignore next */
  (cov_oeny05toy().b[1][1]++, obj.__esModule) ?
  /* istanbul ignore next */
  (cov_oeny05toy().b[0][0]++, obj) :
  /* istanbul ignore next */
  (cov_oeny05toy().b[0][1]++, {
    default: obj
  });
}
/* istanbul ignore next */
cov_oeny05toy().s[10]++;
_restsdk.default.configure({
  mode:
  /* istanbul ignore next */
  (cov_oeny05toy().b[2][0]++, process.env.PAYPAL_MODE) ||
  /* istanbul ignore next */
  (cov_oeny05toy().b[2][1]++, 'sandbox'),
  client_id:
  /* istanbul ignore next */
  (cov_oeny05toy().b[3][0]++, process.env.PAYPAL_CLIENT_ID) ||
  /* istanbul ignore next */
  (cov_oeny05toy().b[3][1]++, ''),
  client_secret:
  /* istanbul ignore next */
  (cov_oeny05toy().b[4][0]++, process.env.PAYPAL_CLIENT_SECRET) ||
  /* istanbul ignore next */
  (cov_oeny05toy().b[4][1]++, '')
});
const stripe =
/* istanbul ignore next */
(cov_oeny05toy().s[11]++, await (0, _stripejs.loadStripe)(
/* istanbul ignore next */
(cov_oeny05toy().b[5][0]++, process.env.STRIPE_SECRET_KEY) ||
/* istanbul ignore next */
(cov_oeny05toy().b[5][1]++, '')));
async function initiatePayment(options) {
  /* istanbul ignore next */
  cov_oeny05toy().f[2]++;
  const {
    userId,
    amount,
    currency,
    paymentMethod,
    description
  } =
  /* istanbul ignore next */
  (cov_oeny05toy().s[12]++, options);
  /* istanbul ignore next */
  cov_oeny05toy().s[13]++;
  try {
    /* istanbul ignore next */
    cov_oeny05toy().s[14]++;
    await (0, _db.connectToDatabase)();
    const seller =
    /* istanbul ignore next */
    (cov_oeny05toy().s[15]++, await _sellermodel.default.findOne({
      userId
    }).lean());
    /* istanbul ignore next */
    cov_oeny05toy().s[16]++;
    if (!seller) {
      /* istanbul ignore next */
      cov_oeny05toy().b[6][0]++;
      cov_oeny05toy().s[17]++;
      throw new Error('Seller not found');
    } else
    /* istanbul ignore next */
    {
      cov_oeny05toy().b[6][1]++;
    }
    const user =
    /* istanbul ignore next */
    (cov_oeny05toy().s[18]++, await _usermodel.default.findById(userId).select('whatsapp').lean());
    const channels =
    /* istanbul ignore next */
    (cov_oeny05toy().s[19]++, user?.whatsapp ?
    /* istanbul ignore next */
    (cov_oeny05toy().b[7][0]++, ['email', 'in_app', 'whatsapp']) :
    /* istanbul ignore next */
    (cov_oeny05toy().b[7][1]++, ['email', 'in_app']));
    let redirectUrl;
    /* istanbul ignore next */
    cov_oeny05toy().s[20]++;
    if (paymentMethod === 'stripe') {
      /* istanbul ignore next */
      cov_oeny05toy().b[8][0]++;
      cov_oeny05toy().s[21]++;
      if (!stripe) {
        /* istanbul ignore next */
        cov_oeny05toy().b[9][0]++;
        cov_oeny05toy().s[22]++;
        throw new Error('Stripe not initialized');
      } else
      /* istanbul ignore next */
      {
        cov_oeny05toy().b[9][1]++;
      }
      const session =
      /* istanbul ignore next */
      (cov_oeny05toy().s[23]++, await stripe.checkout.sessions.create({
        payment_method_types: ['card'],
        line_items: [{
          price_data: {
            currency,
            product_data: {
              name: description
            },
            unit_amount: Math.round(amount * 100)
          },
          quantity: 1
        }],
        mode: 'payment',
        success_url: `${process.env.NEXT_PUBLIC_BASE_URL}/account/subscriptions?success=true`,
        cancel_url: `${process.env.NEXT_PUBLIC_BASE_URL}/account/subscriptions?cancelled=true`,
        metadata: {
          userId,
          description
        }
      }));
      /* istanbul ignore next */
      cov_oeny05toy().s[24]++;
      redirectUrl =
      /* istanbul ignore next */
      (cov_oeny05toy().b[10][0]++, session.url) ||
      /* istanbul ignore next */
      (cov_oeny05toy().b[10][1]++, '');
      /* istanbul ignore next */
      cov_oeny05toy().s[25]++;
      await (0, _notification.sendNotification)({
        userId,
        type: 'payment_success',
        title: 'Payment Initiated',
        message: `Your payment of $${amount} for ${description} has been initiated.`,
        channels,
        data: {
          amount,
          description
        }
      });
    } else {
      /* istanbul ignore next */
      cov_oeny05toy().b[8][1]++;
      cov_oeny05toy().s[26]++;
      if (paymentMethod === 'paypal') {
        /* istanbul ignore next */
        cov_oeny05toy().b[11][0]++;
        const createPaymentJson =
        /* istanbul ignore next */
        (cov_oeny05toy().s[27]++, {
          intent: 'sale',
          payer: {
            payment_method: 'paypal'
          },
          redirect_urls: {
            return_url: `${process.env.NEXT_PUBLIC_BASE_URL}/account/subscriptions?success=true`,
            cancel_url: `${process.env.NEXT_PUBLIC_BASE_URL}/account/subscriptions?cancelled=true`
          },
          transactions: [{
            amount: {
              total: amount.toFixed(2),
              currency
            },
            description
          }]
        });
        /* istanbul ignore next */
        cov_oeny05toy().s[28]++;
        redirectUrl = await new Promise((resolve, reject) => {
          /* istanbul ignore next */
          cov_oeny05toy().f[3]++;
          cov_oeny05toy().s[29]++;
          _restsdk.default.payment.create(createPaymentJson, (error, payment) => {
            /* istanbul ignore next */
            cov_oeny05toy().f[4]++;
            cov_oeny05toy().s[30]++;
            if (error) {
              /* istanbul ignore next */
              cov_oeny05toy().b[12][0]++;
              cov_oeny05toy().s[31]++;
              reject(error);
            } else {
              /* istanbul ignore next */
              cov_oeny05toy().b[12][1]++;
              const approvalUrl =
              /* istanbul ignore next */
              (cov_oeny05toy().s[32]++, payment.links?.find(link => {
                /* istanbul ignore next */
                cov_oeny05toy().f[5]++;
                cov_oeny05toy().s[33]++;
                return link.rel === 'approval_url';
              })?.href);
              /* istanbul ignore next */
              cov_oeny05toy().s[34]++;
              resolve(
              /* istanbul ignore next */
              (cov_oeny05toy().b[13][0]++, approvalUrl) ||
              /* istanbul ignore next */
              (cov_oeny05toy().b[13][1]++, ''));
            }
          });
        });
        /* istanbul ignore next */
        cov_oeny05toy().s[35]++;
        await (0, _notification.sendNotification)({
          userId,
          type: 'payment_success',
          title: 'Payment Initiated',
          message: `Your payment of $${amount} for ${description} has been initiated.`,
          channels,
          data: {
            amount,
            description
          }
        });
      } else {
        /* istanbul ignore next */
        cov_oeny05toy().b[11][1]++;
        cov_oeny05toy().s[36]++;
        throw new Error('Unsupported payment method');
      }
    }
    /* istanbul ignore next */
    cov_oeny05toy().s[37]++;
    return {
      success: true,
      data: {
        redirectUrl
      }
    };
  } catch (error) {
    /* istanbul ignore next */
    cov_oeny05toy().s[38]++;
    console.error('Payment initiation error:', error);
    /* istanbul ignore next */
    cov_oeny05toy().s[39]++;
    return {
      success: false,
      message: error instanceof Error ?
      /* istanbul ignore next */
      (cov_oeny05toy().b[14][0]++, error.message) :
      /* istanbul ignore next */
      (cov_oeny05toy().b[14][1]++, 'Failed to initiate payment')
    };
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJpbml0aWF0ZVBheW1lbnQiLCJfcmVzdHNkayIsImRlZmF1bHQiLCJjb25maWd1cmUiLCJtb2RlIiwiY292X29lbnkwNXRveSIsImIiLCJwcm9jZXNzIiwiZW52IiwiUEFZUEFMX01PREUiLCJjbGllbnRfaWQiLCJQQVlQQUxfQ0xJRU5UX0lEIiwiY2xpZW50X3NlY3JldCIsIlBBWVBBTF9DTElFTlRfU0VDUkVUIiwic3RyaXBlIiwicyIsIl9zdHJpcGVqcyIsImxvYWRTdHJpcGUiLCJTVFJJUEVfU0VDUkVUX0tFWSIsIm9wdGlvbnMiLCJmIiwidXNlcklkIiwiYW1vdW50IiwiY3VycmVuY3kiLCJwYXltZW50TWV0aG9kIiwiZGVzY3JpcHRpb24iLCJfZGIiLCJjb25uZWN0VG9EYXRhYmFzZSIsInNlbGxlciIsIl9zZWxsZXJtb2RlbCIsImZpbmRPbmUiLCJsZWFuIiwiRXJyb3IiLCJ1c2VyIiwiX3VzZXJtb2RlbCIsImZpbmRCeUlkIiwic2VsZWN0IiwiY2hhbm5lbHMiLCJ3aGF0c2FwcCIsInJlZGlyZWN0VXJsIiwic2Vzc2lvbiIsImNoZWNrb3V0Iiwic2Vzc2lvbnMiLCJjcmVhdGUiLCJwYXltZW50X21ldGhvZF90eXBlcyIsImxpbmVfaXRlbXMiLCJwcmljZV9kYXRhIiwicHJvZHVjdF9kYXRhIiwibmFtZSIsInVuaXRfYW1vdW50IiwiTWF0aCIsInJvdW5kIiwicXVhbnRpdHkiLCJzdWNjZXNzX3VybCIsIk5FWFRfUFVCTElDX0JBU0VfVVJMIiwiY2FuY2VsX3VybCIsIm1ldGFkYXRhIiwidXJsIiwiX25vdGlmaWNhdGlvbiIsInNlbmROb3RpZmljYXRpb24iLCJ0eXBlIiwidGl0bGUiLCJtZXNzYWdlIiwiZGF0YSIsImNyZWF0ZVBheW1lbnRKc29uIiwiaW50ZW50IiwicGF5ZXIiLCJwYXltZW50X21ldGhvZCIsInJlZGlyZWN0X3VybHMiLCJyZXR1cm5fdXJsIiwidHJhbnNhY3Rpb25zIiwidG90YWwiLCJ0b0ZpeGVkIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJwYXltZW50IiwiZXJyb3IiLCJhcHByb3ZhbFVybCIsImxpbmtzIiwiZmluZCIsImxpbmsiLCJyZWwiLCJocmVmIiwic3VjY2VzcyIsImNvbnNvbGUiXSwic291cmNlcyI6WyIvaG9tZS9oYWdlci9uZXcvbXktbmV4dGpzLXByb2plY3QtbWFzdGVyICgzKS9teS1uZXh0anMtcHJvamVjdC1tYXN0ZXIvbGliL2FjdGlvbnMvcGF5bWVudC5hY3Rpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGxvYWRTdHJpcGUgfSBmcm9tICdAc3RyaXBlL3N0cmlwZS1qcydcbmltcG9ydCBwYXlwYWwgZnJvbSAnQHBheXBhbC9yZXN0LXNkaydcbmltcG9ydCB7IGNvbm5lY3RUb0RhdGFiYXNlIH0gZnJvbSAnQC9saWIvZGInXG5pbXBvcnQgU2VsbGVyIGZyb20gJ0AvbGliL2RiL21vZGVscy9zZWxsZXIubW9kZWwnXG5pbXBvcnQgVXNlciBmcm9tICdAL2xpYi9kYi9tb2RlbHMvdXNlci5tb2RlbCdcbmltcG9ydCB7IHNlbmROb3RpZmljYXRpb24gfSBmcm9tICdAL2xpYi91dGlscy9ub3RpZmljYXRpb24nXG5cbnBheXBhbC5jb25maWd1cmUoe1xuICBtb2RlOiBwcm9jZXNzLmVudi5QQVlQQUxfTU9ERSB8fCAnc2FuZGJveCcsXG4gIGNsaWVudF9pZDogcHJvY2Vzcy5lbnYuUEFZUEFMX0NMSUVOVF9JRCB8fCAnJyxcbiAgY2xpZW50X3NlY3JldDogcHJvY2Vzcy5lbnYuUEFZUEFMX0NMSUVOVF9TRUNSRVQgfHwgJycsXG59KVxuXG5jb25zdCBzdHJpcGUgPSBhd2FpdCBsb2FkU3RyaXBlKHByb2Nlc3MuZW52LlNUUklQRV9TRUNSRVRfS0VZIHx8ICcnKVxuXG5pbnRlcmZhY2UgUGF5bWVudE9wdGlvbnMge1xuICB1c2VySWQ6IHN0cmluZ1xuICBhbW91bnQ6IG51bWJlclxuICBjdXJyZW5jeTogc3RyaW5nXG4gIHBheW1lbnRNZXRob2Q6ICdzdHJpcGUnIHwgJ3BheXBhbCdcbiAgZGVzY3JpcHRpb246IHN0cmluZ1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdGlhdGVQYXltZW50KG9wdGlvbnM6IFBheW1lbnRPcHRpb25zKSB7XG4gIGNvbnN0IHsgdXNlcklkLCBhbW91bnQsIGN1cnJlbmN5LCBwYXltZW50TWV0aG9kLCBkZXNjcmlwdGlvbiB9ID0gb3B0aW9uc1xuXG4gIHRyeSB7XG4gICAgYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKVxuICAgIGNvbnN0IHNlbGxlciA9IGF3YWl0IFNlbGxlci5maW5kT25lKHsgdXNlcklkIH0pLmxlYW4oKVxuICAgIGlmICghc2VsbGVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NlbGxlciBub3QgZm91bmQnKVxuICAgIH1cblxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHVzZXJJZCkuc2VsZWN0KCd3aGF0c2FwcCcpLmxlYW4oKVxuICAgIGNvbnN0IGNoYW5uZWxzID0gdXNlcj8ud2hhdHNhcHAgPyBbJ2VtYWlsJywgJ2luX2FwcCcsICd3aGF0c2FwcCddIDogWydlbWFpbCcsICdpbl9hcHAnXVxuXG4gICAgbGV0IHJlZGlyZWN0VXJsOiBzdHJpbmdcblxuICAgIGlmIChwYXltZW50TWV0aG9kID09PSAnc3RyaXBlJykge1xuICAgICAgaWYgKCFzdHJpcGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdHJpcGUgbm90IGluaXRpYWxpemVkJylcbiAgICAgIH1cbiAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBzdHJpcGUuY2hlY2tvdXQuc2Vzc2lvbnMuY3JlYXRlKHtcbiAgICAgICAgcGF5bWVudF9tZXRob2RfdHlwZXM6IFsnY2FyZCddLFxuICAgICAgICBsaW5lX2l0ZW1zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgcHJpY2VfZGF0YToge1xuICAgICAgICAgICAgICBjdXJyZW5jeSxcbiAgICAgICAgICAgICAgcHJvZHVjdF9kYXRhOiB7IG5hbWU6IGRlc2NyaXB0aW9uIH0sXG4gICAgICAgICAgICAgIHVuaXRfYW1vdW50OiBNYXRoLnJvdW5kKGFtb3VudCAqIDEwMCksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcXVhbnRpdHk6IDEsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgbW9kZTogJ3BheW1lbnQnLFxuICAgICAgICBzdWNjZXNzX3VybDogYCR7cHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQkFTRV9VUkx9L2FjY291bnQvc3Vic2NyaXB0aW9ucz9zdWNjZXNzPXRydWVgLFxuICAgICAgICBjYW5jZWxfdXJsOiBgJHtwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19CQVNFX1VSTH0vYWNjb3VudC9zdWJzY3JpcHRpb25zP2NhbmNlbGxlZD10cnVlYCxcbiAgICAgICAgbWV0YWRhdGE6IHsgdXNlcklkLCBkZXNjcmlwdGlvbiB9LFxuICAgICAgfSlcbiAgICAgIHJlZGlyZWN0VXJsID0gc2Vzc2lvbi51cmwgfHwgJydcblxuICAgICAgYXdhaXQgc2VuZE5vdGlmaWNhdGlvbih7XG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgdHlwZTogJ3BheW1lbnRfc3VjY2VzcycsXG4gICAgICAgIHRpdGxlOiAnUGF5bWVudCBJbml0aWF0ZWQnLFxuICAgICAgICBtZXNzYWdlOiBgWW91ciBwYXltZW50IG9mICQke2Ftb3VudH0gZm9yICR7ZGVzY3JpcHRpb259IGhhcyBiZWVuIGluaXRpYXRlZC5gLFxuICAgICAgICBjaGFubmVscyxcbiAgICAgICAgZGF0YTogeyBhbW91bnQsIGRlc2NyaXB0aW9uIH0sXG4gICAgICB9KVxuICAgIH0gZWxzZSBpZiAocGF5bWVudE1ldGhvZCA9PT0gJ3BheXBhbCcpIHtcbiAgICAgIGNvbnN0IGNyZWF0ZVBheW1lbnRKc29uID0ge1xuICAgICAgICBpbnRlbnQ6ICdzYWxlJyxcbiAgICAgICAgcGF5ZXI6IHsgcGF5bWVudF9tZXRob2Q6ICdwYXlwYWwnIH0sXG4gICAgICAgIHJlZGlyZWN0X3VybHM6IHtcbiAgICAgICAgICByZXR1cm5fdXJsOiBgJHtwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19CQVNFX1VSTH0vYWNjb3VudC9zdWJzY3JpcHRpb25zP3N1Y2Nlc3M9dHJ1ZWAsXG4gICAgICAgICAgY2FuY2VsX3VybDogYCR7cHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQkFTRV9VUkx9L2FjY291bnQvc3Vic2NyaXB0aW9ucz9jYW5jZWxsZWQ9dHJ1ZWAsXG4gICAgICAgIH0sXG4gICAgICAgIHRyYW5zYWN0aW9uczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGFtb3VudDogeyB0b3RhbDogYW1vdW50LnRvRml4ZWQoMiksIGN1cnJlbmN5IH0sXG4gICAgICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfVxuXG4gICAgICByZWRpcmVjdFVybCA9IGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgcGF5cGFsLnBheW1lbnQuY3JlYXRlKGNyZWF0ZVBheW1lbnRKc29uLCAoZXJyb3IsIHBheW1lbnQpID0+IHtcbiAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJlamVjdChlcnJvcilcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgYXBwcm92YWxVcmwgPSBwYXltZW50LmxpbmtzPy5maW5kKGxpbmsgPT4gbGluay5yZWwgPT09ICdhcHByb3ZhbF91cmwnKT8uaHJlZlxuICAgICAgICAgICAgcmVzb2x2ZShhcHByb3ZhbFVybCB8fCAnJylcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9KVxuXG4gICAgICBhd2FpdCBzZW5kTm90aWZpY2F0aW9uKHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICB0eXBlOiAncGF5bWVudF9zdWNjZXNzJyxcbiAgICAgICAgdGl0bGU6ICdQYXltZW50IEluaXRpYXRlZCcsXG4gICAgICAgIG1lc3NhZ2U6IGBZb3VyIHBheW1lbnQgb2YgJCR7YW1vdW50fSBmb3IgJHtkZXNjcmlwdGlvbn0gaGFzIGJlZW4gaW5pdGlhdGVkLmAsXG4gICAgICAgIGNoYW5uZWxzLFxuICAgICAgICBkYXRhOiB7IGFtb3VudCwgZGVzY3JpcHRpb24gfSxcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVW5zdXBwb3J0ZWQgcGF5bWVudCBtZXRob2QnKVxuICAgIH1cblxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHsgcmVkaXJlY3RVcmwgfSB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignUGF5bWVudCBpbml0aWF0aW9uIGVycm9yOicsIGVycm9yKVxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBpbml0aWF0ZSBwYXltZW50JyxcbiAgICB9XG4gIH1cbn0iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzsrQkF1QnNCOzs7Ozs7V0FBQUEsZUFBQTs7Ozs7aUNBdkJLOzs7dUVBQ1I7OztpQ0FDZTs7O3VFQUNmOzs7dUVBQ0Y7OztpQ0FDZ0I7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRWpDQyxRQUFBLENBQUFDLE9BQU0sQ0FBQ0MsU0FBUyxDQUFDO0VBQ2ZDLElBQUE7RUFBTTtFQUFBLENBQUFDLGFBQUEsR0FB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