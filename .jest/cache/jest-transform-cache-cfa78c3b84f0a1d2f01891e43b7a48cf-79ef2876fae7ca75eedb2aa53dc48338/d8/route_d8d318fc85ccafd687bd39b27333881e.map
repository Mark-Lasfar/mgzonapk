{"version":3,"names":["POST","req","cov_s0uk17stt","f","s","productId","saleAmount","sellerId","json","b","_server","NextResponse","success","message","status","product","_productmodel","default","findById","seller","_partnermodel","revenueDetails","_revenuesharing","handleRevenueSharing","balance","sellerRevenue","save","user","_usermodel","findOne","businessProfile","_pointsactions","awardPoints","_id","toString","data","error","console"],"sources":["/home/hager/new/my-nextjs-project-master (3)/my-nextjs-project-master/app/api/sales/record/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { handleRevenueSharing } from '@/lib/actions/revenue-sharing';\nimport Partner from '@/lib/db/models/partner.model';\nimport Product from '@/lib/db/models/product.model';\nimport User from '@/lib/db/models/user.model';\nimport { awardPoints } from '@/lib/actions/points.actions';\n\nexport async function POST(req: NextRequest) {\n  try {\n    const { productId, saleAmount, sellerId } = await req.json();\n\n    // Validate inputs\n    if (!productId || !saleAmount || !sellerId) {\n      return NextResponse.json(\n        { success: false, message: 'Missing required fields' },\n        { status: 400 }\n      );\n    }\n\n    // Verify product\n    const product = await Product.findById(productId);\n    if (!product) {\n      return NextResponse.json({ success: false, message: 'Product not found' }, { status: 404 });\n    }\n\n    // Verify seller\n    const seller = await Partner.findById(sellerId);\n    if (!seller) {\n      return NextResponse.json({ success: false, message: 'Seller not found' }, { status: 404 });\n    }\n\n    // Handle revenue sharing\n    const revenueDetails = await handleRevenueSharing(productId, saleAmount);\n\n    // Credit seller's balance\n    seller.balance += revenueDetails.sellerRevenue;\n    await seller.save();\n\n    // Award points to seller\n    const user = await User.findOne({ businessProfile: sellerId });\n    if (user) {\n      await awardPoints(user._id.toString(), 10, `Sale of product ${productId}`);\n    }\n\n    return NextResponse.json({ success: true, data: revenueDetails });\n  } catch (error: any) {\n    console.error('Error processing sale:', error);\n    return NextResponse.json({ success: false, message: error.message }, { status: 500 });\n  }\n}"],"mappings":"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","ignoreList":[]}