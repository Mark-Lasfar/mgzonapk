{"version":3,"names":["cov_20ryvfje17","actualCoverage","s","GET","f","POST","snapshot","_admin","adminFirestore","collection","orderBy","get","tickets","docs","map","doc","id","data","_server","NextResponse","json","error","console","status","request","ticket","add","createdAt","Date","updatedAt","comments","_metrics","metricsService","saveMetric","type","_metrics1","MetricType","SUPPORT","value","metadata","ticketId","category"],"sources":["/home/hager/new/my-nextjs-project-master (3)/my-nextjs-project-master/app/api/v1/support/tickets/route.ts"],"sourcesContent":["// /app/api/v1/support/tickets/route.ts\n\nimport { NextResponse } from 'next/server';\nimport { adminFirestore } from '@/lib/firebase/admin';\nimport { metricsService } from '@/lib/api/services/metrics';\nimport { MetricType } from '@/types/metrics';\n\nexport async function GET() {\n  try {\n    const snapshot = await adminFirestore\n      .collection('tickets')\n      .orderBy('createdAt', 'desc')\n      .get();\n\n    const tickets = snapshot.docs.map(doc => ({\n      id: doc.id,\n      ...doc.data()\n    }));\n\n    return NextResponse.json(tickets);\n  } catch (error) {\n    console.error('Error fetching tickets:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch tickets' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const data = await request.json();\n    \n    const ticket = await adminFirestore.collection('tickets').add({\n      ...data,\n      status: 'open',\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      comments: []\n    });\n\n    // Track metric\n    await metricsService.saveMetric({\n      type: MetricType.SUPPORT,\n      value: 1,\n      metadata: {\n        ticketId: ticket.id,\n        category: data.category\n      }\n    });\n\n    return NextResponse.json({ id: ticket.id });\n  } catch (error) {\n    console.error('Error creating ticket:', error);\n    return NextResponse.json(\n      { error: 'Failed to create ticket' },\n      { status: 500 }\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}