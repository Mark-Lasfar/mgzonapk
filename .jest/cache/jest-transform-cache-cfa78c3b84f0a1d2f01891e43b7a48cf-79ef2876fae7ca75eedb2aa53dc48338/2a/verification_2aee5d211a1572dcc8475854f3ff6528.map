{"version":3,"names":["checkVerificationAttempts","cov_1izi8gakre","f","s","resetVerificationAttempts","updateVerificationAttempts","email","user","_usermodel","default","findOne","b","_server","NextResponse","json","error","status","lastAttempt","lastVerificationAttempt","attempts","verificationAttempts","valid","timeRemaining","_validation","validation","validateVerificationAttempts","cooldown","Math","ceil","_email","EMAIL_CONFIG","VERIFICATION_COOLDOWN","now","Date","findOneAndUpdate","$inc"],"sources":["/home/hager/new/my-nextjs-project-master (3)/my-nextjs-project-master/lib/middleware/verification.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { validation } from '@/lib/utils/validation';\nimport User from '@/lib/db/models/user.model';\nimport { EMAIL_CONFIG } from '@/lib/config/email';\n\nexport async function checkVerificationAttempts(\n  email: string\n): Promise<NextResponse | null> {\n  const user = await User.findOne({ email });\n  \n  if (!user) {\n    return NextResponse.json(\n      { error: 'User not found' },\n      { status: 404 }\n    );\n  }\n\n  const lastAttempt = user.lastVerificationAttempt;\n  const attempts = user.verificationAttempts || 0;\n\n  const { valid, timeRemaining } = validation.validateVerificationAttempts(\n    attempts,\n    lastAttempt\n  );\n\n  if (!valid) {\n    return NextResponse.json(\n      {\n        error: 'Too many attempts',\n        timeRemaining,\n        cooldown: Math.ceil(EMAIL_CONFIG.VERIFICATION_COOLDOWN / 1000)\n      },\n      { status: 429 }\n    );\n  }\n\n  return null;\n}\n\nexport async function updateVerificationAttempts(email: string): Promise<void> {\n  const now = new Date();\n  await User.findOneAndUpdate(\n    { email },\n    {\n      $inc: { verificationAttempts: 1 },\n      lastVerificationAttempt: now\n    }\n  );\n}\n\nexport async function resetVerificationAttempts(email: string): Promise<void> {\n  await User.findOneAndUpdate(\n    { email },\n    {\n      verificationAttempts: 0,\n      lastVerificationAttempt: null\n    }\n  );\n}"],"mappings":"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","ignoreList":[]}